!function(){function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var p=i[s]={exports:{}};e[s][0].call(p.exports,function(t){var i=e[s][1][t];return o(i?i:t)},p,p.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}return t}()({1:[function(t,e,i){function n(t){this.message=t}function o(t,e){if(!t)throw new n(e)}function r(t){var e={};return t&&"[object Function]"===e.toString.call(t)}function s(t,e){}function a(t){var e;return e=convert.keyword.rgb(t),"undefined"!=typeof e?e.concat([255]):(e=convert.hex.rgb(t),"undefined"!=typeof e?e.concat([255]):Array.isArray(t)&&4==t.length?t:(console.log("Uh oh -- unknown color type passed!"),[128,128,128,255]))}function h(t){return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"}function c(t,e,i){"undefined"==typeof i&&(i=1);var n=a(t),o=n[3]*i,r=n.slice(0,3);if(r.every(function(t){return 0===t}))return t;r=r.map(function(t){return 255-(255-t)*(1-e)});for(var s=0;s<3;s++)n[s]=r[s];return n[3]=o,h(n)}function p(t,e){return t[0]===e[0]&t[1]===e[1]}function l(t,e){if(t.length!==e.length)return!1;for(var i=t.length;i--;)if(!p(t[i],e[i]))return!1;return!0}function u(t,e){return t[0]<e[0]?[t,e]:t[0]===e[0]&&t[1]<e[1]?[t,e]:[e,t]}function d(t){var e,i,n,o,r,s,a=[];for(i=0;i<t.length;i+=1)for(e=t[i],n=0;n<e.length;n+=1)o=e[n],r=e[(n+1)%e.length],a.push(u(o,r));var h=[];for(i=0;i<a.length;i+=1){s=a[i];var c=!0;for(n=0;n<a.length;n+=1)n!==i&l(s,a[n])&&(c=!1);c&&h.push(s)}for(var d=h.splice(0,1)[0],y=[d[0],d[1]],f=d[1];h.length>1;){var v=!0;for(n=0;n<h.length&v;n++)d=h[n],p(f,d[0])?(y.push(d[1]),f=d[1],h.splice(n,1),v=!1):p(f,d[1])&&(y.push(d[0]),f=d[0],h.splice(n,1),v=!1);if(v)return console.log("Error: cannot find point in unique edges"),console.log("Point: "+f),void console.log(h)}return y}function y(t){if(t.length%2!==0)return console.log("ERROR: flat vertex list must have length multiple of 2"),!1;for(var e=[],i=0;i<t.length;i+=2)e.push([t[i],t[i+1]]);return e}function f(t){var e=t.getShapes(),i=e[0],n=e[1];return[i.name,n.name]}function v(t,e,i){return i._solidSolidBegin(t,e,i),!0}function b(t,e,i){return i._solidSolidPre(t,e,i),!0}function g(t,e,i){return i._solidSolidPost(t,e,i),!0}function _(t,e,i){return i._solidSolidEnd(t,e,i),!0}function m(t,e,i){return i._solidGoalBegin(t,e,i),!1}function S(t,e,i){return i._solidGoalEnd(t,e,i),!1}function x(t,e){var i=Math.sin(e),n=Math.cos(e);return[t[0]*n-t[1]*i,t[0]*i+t[1]*n]}function P(t){for(var e=[],i=t.length-2;i>=0;i-=2)e.push(t[i],t[i+1]);return e}function w(t){for(var e=t.getContactPointSet(),i=[],n=[],o=0;o<e.length;o++){var r=e[o];i.push(r.normal),n.push(r.point)}return[i,t.e,n]}cp=t("chipmunk"),convert=t("color-convert"),DEFAULT_DENSITY=1,DEFAULT_ELASTICITY=.5,DEFAULT_FRICTION=.5,DEFAULT_COLOR="black",DEFAULT_GOAL_COLOR="green",COLTYPE_SOLID=100,COLTYPE_SENSOR=101,COLTYPE_PLACED=102,COLTYPE_BLOCKED=103,COLTYPE_CHECKER=104,n.prototype.toString=function(){return"AssertException: "+this.message};var C=function(t,e,i,n){return t*n-e*i},A=function(t){for(var e=t.length,i=0;i<e;i+=2){var n=t[i],o=t[i+1],r=t[(i+2)%e],s=t[(i+3)%e],a=t[(i+4)%e],h=t[(i+5)%e];if(C(r-n,s-o,a-r,h-s)>0)return!1}return!0},j=function(t,e,i){var n=[e[0]-t[0],e[1]-t[1]],o=[i[0]-t[0],i[1]-t[1]],r=n[0]*o[1]-n[1]*o[0];return r>0},B=function(t,e){o(t.length>7&&t.length%2===0,"Need at least four points in flat structure to poly-ize");for(var i=[],n=0;n<t.length-1;n+=2)i.push(new cp.v(t[n],t[n+1]));var r,s,a=cp.v.sub(i[1],i[0]),h=i[0],c=cp.v.toangle(a);c<=-Math.PI/4&&c>=3*-Math.PI/4?(r=[h.x-e,h.y],s=[h.x+e,h.y]):c>=Math.PI/4&&c<=3*Math.PI/4?(r=[h.x+e,h.y],s=[h.x-e,h.y]):c>=-Math.PI/4&&c<=Math.PI/4?(r=[h.x,h.y-e],s=[h.x,h.y+e]):(r=[h.x,h.y+e],s=[h.x,h.y-e]);for(var p,l,u,d,y,f,v,b,g,_,m,S,x,P,w=[],n=1;n<i.length-1;n++){if(p=i[n],l=i[n-1],u=i[n+1],d=cp.v.sub(l,p),y=cp.v.sub(u,p),f=cp.v.toangle(d),v=cp.v.toangle(y),b=(f-v)%(2*Math.PI),g=(v+b/2)%(2*Math.PI),g<0&&(g+=2*Math.PI),_=cp.v.forangle(g),m=_.x>=0?e:-e,S=_.y>=0?e:-e,x=[p.x+m,p.y+S],P=[p.x-m,p.y-S],j(s,x,P)){var C=P;P=x,x=C}w.push([r[0],r[1],s[0],s[1],x[0],x[1],P[0],P[1]]),r=P,s=x}var A=cp.v.sub(i[i.length-2],i[i.length-1]),B=i[i.length-1],k=cp.v.toangle(A);return k<=-Math.PI/4&&k>=3*-Math.PI/4?(x=[B.x-e,B.y],P=[B.x+e,B.y]):k>=Math.PI/4&&k<=3*Math.PI/4?(x=[B.x+e,B.y],P=[B.x-e,B.y]):k>=-Math.PI/4&&k<=Math.PI/4?(x=[B.x,B.y-e],P=[B.x,B.y+e]):(x=[B.x,B.y+e],P=[B.x,B.y-e]),w.push([r[0],r[1],s[0],s[1],x[0],x[1],P[0],P[1]]),w};PGObject=function(t,e,i,n,r,s,a){var h=["Ball","Poly","Segment","Container","Compound","Goal","Blocker"];o(h.indexOf(e)>-1,"Invalid 'type' of object"),this.name=t,this.type=e,this.space=i,this.color=n,this.density=r,this.elasticity=s,this.friction=a},PGObject.prototype.isStatic=function(){return null===this.cpBody},PGObject.prototype.getPos=function(){o(!this.isStatic(),"Static bodies do not have a position");var t=this.cpBody.getPos();return[t.x,t.y]},PGObject.prototype.setPos=function(t){o(!this.isStatic(),"Cannot set the position of static objects"),o(2===t.length,"Position requires array of length 2");var e=new cp.v(t[0],t[1]);this.cpBody.setPos(e)},PGObject.prototype.getVel=function(){o(!this.isStatic(),"Static bodies do not have a velocity");var t=this.cpBody.getVel();return[t.x,t.y]},PGObject.prototype.setVel=function(t){o(!this.isStatic(),"Cannot set the velocity of static objects"),o(2===t.length,"Velocity requires array of length 2");var e=new cp.v(t[0],t[1]);this.cpBody.setVel(e)},PGObject.prototype.getRot=function(){return o(!this.isStatic(),"Static bodies do not have a rotation"),this.cpBody.a},PGObject.prototype.setRot=function(t){o(!this.isStatic(),"Static bodies do not have a rotation"),this.cpBody.setAngle(t)},PGObject.prototype.getMass=function(){return this.isStatic()?0:this.cpBody.m},PGObject.prototype._exposeShapes=function(){return[this.cpShape]},PGObject.prototype.checkContact=function(t){for(var e=this._exposeShapes(),i=t._exposeShapes(),n=0;n<e.length;n++)for(var o=e[n],r=0;r<i.length;r++){oshapes=i[r];var s,a;o.collisionCode<=oshapes.collisionCode?(s=o,a=oshapes):(s=oshapes,a=o);var h=cp.collideShapes(s,a);if(h.length>0)return!0}return!1},PGPoly=function(t,e,i,n,o,r,s){for(var n="undefined"!=typeof n?n:DEFAULT_DENSITY,o="undefined"!=typeof o?o:DEFAULT_ELASTICITY,r="undefined"!=typeof r?r:DEFAULT_FRICTION,s="undefined"!=typeof s?s:DEFAULT_COLOR,a=[],h=0;h<i.length;h++){var c=i[h];a.push(c[0]),a.push(c[1])}PGObject.call(this,t,"Poly",e,s,n,o,r);var p=cp.centroidForPoly(a);cp.recenterPoly(a);var l=cp.areaForPoly(a),u=n*l,d=cp.momentForPoly(u,a,cp.vzero);0===u?(this.cpBody=null,this.cpShape=new cp.PolyShape(e.staticBody,a,p),this.cpShape.setElasticity(o),this.cpShape.setFriction(r),this.cpShape.setCollisionType(COLTYPE_SOLID),this.cpShape.name=t,e.addShape(this.cpShape)):(this.cpBody=new cp.Body(u,d),this.cpShape=new cp.PolyShape(this.cpBody,a,cp.vzero),this.cpShape.setElasticity(o),this.cpShape.setFriction(r),this.cpShape.setCollisionType(COLTYPE_SOLID),this.cpShape.name=t,this.cpBody.setPos(new cp.v(p.x,p.y)),e.addBody(this.cpBody),e.addShape(this.cpShape))},PGPoly.prototype=Object.create(PGObject.prototype),PGPoly.prototype.getVertices=function(){var t=[];if(this.isStatic())for(var e=0;e<this.cpShape.verts.length-1;e+=2){var i=[this.cpShape.verts[e],this.cpShape.verts[e+1]];t.push(i)}else for(var n=this.getPos(),o=this.getRot(),e=0;e<this.cpShape.verts.length-1;e+=2){var i=[this.cpShape.verts[e],this.cpShape.verts[e+1]];i=x(i,o),t.push([i[0]+n[0],i[1]+n[1]])}return t},PGPoly.prototype.getArea=function(){return cp.areaForPoly(this.getVertices())},PGPoly.prototype.getPos=function(){if(this.isStatic())return cp.centroidForPoly(this.getVertices());var t=this.cpBody.getPos();return[t.x,t.y]},PGBall=function(t,e,i,n,o,r,s,a){var o="undefined"!=typeof o?o:DEFAULT_DENSITY,r="undefined"!=typeof r?r:DEFAULT_ELASTICITY,s="undefined"!=typeof s?s:DEFAULT_FRICTION,a="undefined"!=typeof a?a:DEFAULT_COLOR;PGObject.call(this,t,"Ball",e,a,o,r,s);var h=Math.PI*n*n,c=o*h,p=cp.momentForCircle(c,0,n,cp.vzero),l=new cp.v(i[0],i[1]);0===c?(this.cpBody=null,this.cpShape=new cp.CircleShape(e.staticBody,n,l),this.cpShape.setElasticity(r),this.cpShape.setFriction(s),this.cpShape.setCollisionType(COLTYPE_SOLID),this.cpShape.name=t,e.addShape(this.cpShape)):(this.cpBody=new cp.Body(c,p),this.cpShape=new cp.CircleShape(this.cpBody,n,cp.vzero),this.cpShape.setElasticity(r),this.cpShape.setFriction(s),this.cpShape.setCollisionType(COLTYPE_SOLID),this.cpShape.name=t,this.cpBody.setPos(l),e.addBody(this.cpBody),e.addShape(this.cpShape))},PGBall.prototype=Object.create(PGObject.prototype),PGBall.prototype.getRadius=function(){return this.cpShape.r},PGBall.prototype.getArea=function(){var t=this.getRadius();return Math.PI*t*t},PGBall.prototype.getPos=function(){var t;return t=this.isStatic()?this.cpShape.tc:this.cpBody.getPos(),[t.x,t.y]},PGSeg=function(t,e,i,n,o,r,s,a,h){var r="undefined"!=typeof r?r:DEFAULT_DENSITY,s="undefined"!=typeof s?s:DEFAULT_ELASTICITY,a="undefined"!=typeof a?a:DEFAULT_FRICTION,h="undefined"!=typeof h?h:DEFAULT_COLOR;PGObject.call(this,t,"Segment",e,h,r,s,a);var c=new cp.v(i[0],i[1]),p=new cp.v(n[0],n[1]),l=o/2;this.r=l;var u=cp.areaForSegment(c,p,l),d=r*u,y=cp.momentForSegment(d,c,p);if(0===d)this.cpBody=null,this.cpShape=new cp.SegmentShape(e.staticBody,c,p,l),this.cpShape.setElasticity(s),this.cpShape.setFriction(a),this.cpShape.setCollisionType(COLTYPE_SOLID),this.cpShape.name=t,e.addShape(this.cpShape);else{this.cpBody=new cp.Body(d,y);var f=new cp.v((c.x+p.x)/2,(c.y+p.y)/2);c=cp.v.sub(c,f),p=cp.v.sub(p,f),this.cpShape=new cp.SegmentShape(this.cpBody,c,p,l),this.cpShape.setElasticity(s),this.cpShape.setFriction(a),this.cpShape.setCollisionType(COLTYPE_SOLID),this.cpShape.name=t,this.cpBody.setPos(f),e.addBody(this.cpBody),e.addShape(this.cpShape)}},PGSeg.prototype=Object.create(PGObject.prototype),PGSeg.prototype.getPoints=function(){var t,e,i=this.cpShape.a,n=this.cpShape.b;if(this.isStatic())t=[i.x,i.y],e=[n.x,n.y];else{var o=this.getPos(),r=this.getRot(),s=x([i.x,i.y],r),a=x([n.x,n.y],r);t=[s[0]+o[0],s[1]+o[1]],e=[a[0]+o[0],a[1]+o[1]]}return[t,e]},PGContainer=function(t,e,i,n,o,r,s,a,h){var o="undefined"!=typeof o?o:DEFAULT_DENSITY,r="undefined"!=typeof r?r:DEFAULT_ELASTICITY,s="undefined"!=typeof s?s:DEFAULT_FRICTION,a="undefined"!=typeof a?a:DEFAULT_GOAL_COLOR,h="undefined"!=typeof h?h:DEFAULT_COLOR;PGObject.call(this,t,"Container",e,h,o,r,s),this.innerColor=a,this.outerColor=h;var c=n/2;this.r=c;for(var p=[],l=0;l<i.length;l++){var u=i[l];p.push(u[0]),p.push(u[1])}var f=cp.centroidForPoly(p);0!==o&&cp.recenterPoly(p),this.seglist=[];for(var l=0;l<p.length-1;l+=2)this.seglist.push(new cp.v(p[l],p[l+1]));this.area=Math.PI*c*c;for(var v=0,l=0;l<this.seglist.length-1;l++){var b=this.seglist[l],g=this.seglist[l+1],_=2*c*cp.v.dist(b,g);this.area+=_,v+=cp.momentForSegment(_*o,b,g)}var m,S=o*this.area;0===S?(this.cpBody=null,m=e.staticBody):(this.cpBody=m=new cp.Body(S,v),e.addBody(this.cpBody)),this.cpPolyShapes=[],this.polylist=B(p,c);for(var l=0;l<this.polylist.length;l++){var x=new cp.PolyShape(m,this.polylist[l],cp.vzero);x.setElasticity(r),x.setFriction(s),x.setCollisionType(COLTYPE_SOLID),x.name=t,this.cpPolyShapes.push(x),e.addShape(x)}A(p)||(p=P(p)),this.cpSensor=new cp.PolyShape(m,p,cp.vzero),this.cpSensor.sensor=!0,this.cpSensor.setCollisionType(COLTYPE_SENSOR),this.cpSensor.name=t,e.addShape(this.cpSensor),0!==S&&this.cpBody.setPos(f);var w=this.polylist.map(y);this.outline=d(w)},PGContainer.prototype=Object.create(PGObject.prototype),PGContainer.prototype.getPolys=function(){var t=[];if(this.isStatic())for(var e=0;e<this.polylist.length;e++){for(var i=[],n=0;n<this.polylist[e].length;n+=2)i.push([this.polylist[e][n],this.polylist[e][n+1]]);t.push(i)}else for(var o=this.getPos(),r=this.getRot(),e=0;e<this.polylist.length;e++){for(var i=[],n=0;n<this.polylist[e].length;n+=2){var s=x([this.polylist[e][n],this.polylist[e][n+1]],r);i.push([s[0]+o[0],s[1]+o[1]])}t.push(i)}return t},PGContainer.prototype.getVertices=function(){for(var t=[],e=this.cpBody,i=0;i<this.seglist.length;i++){var n=this.seglist[i];if(null===e)t.push([n.x,n.y]);else{var o=this.cpBody.local2World(n);t.push([o.x,o.y])}}return t},PGContainer.prototype.getOutline=function(){if(this.isStatic())return this.outline;var t=this.getPos(),e=this.getRot(),i=function(i){return i=x(i,e),[i[0]+t[0],i[1]+t[1]]};return this.outline.map(i)},PGContainer.prototype.pointIn=function(t){var e=new cp.v(t[0],t[1]);return this.cpSensor.pointQuery(e)},PGContainer.prototype._exposeShapes=function(){return this.cpPolyShapes},PGCompound=function(t,e,i,n,o,r,s){var n="undefined"!=typeof n?n:DEFAULT_DENSITY,o="undefined"!=typeof o?o:DEFAULT_ELASTICITY,r="undefined"!=typeof r?r:DEFAULT_FRICTION,s="undefined"!=typeof s?s:DEFAULT_COLOR;if(PGObject.call(this,t,"Compound",e,s,n,o,r),this.area=0,this.polylist=[],0===n){this.cpShapes=[],this.cpBody=null;for(var a=0;a<i.length;a++){for(var h=i[a],c=[],p=0;p<h.length;p++){var l=h[p];c.push(l[0]),c.push(l[1])}var u=new cp.PolyShape(e.staticBody,c,cp.vzero);u.setElasticity(o),u.setFriction(r),u.setCollisionType(COLTYPE_SOLID),u.name=t,e.addShape(u),this.cpShapes.push(u),this.area+=cp.areaForPoly(c),this.polylist.push(c)}}else{for(var f=[],v=[],b=[],a=0;a<i.length;a++){for(var h=i[a],c=[],p=0;p<h.length;p++){var l=h[p];c.push(l[0]),c.push(l[1])}f.push(cp.centroidForPoly(c)),cp.recenterPoly(c),v.push(c),b.push(cp.areaForPoly(c))}for(var g=0,_=0,a=0;a<f.length;a++)g+=f[a].x*b[a],_+=f[a].y*b[a],this.area+=b[a];g/=this.area,_/=this.area;var m=[g,_];this.cpShapes=[];for(var S=0,a=0;a<v.length;a++){fverts=v[a];for(var x=[],P=new cp.v(f[a].x-m[0],f[a].y-m[1]),p=0;p<fverts.length;p++)x.push(fverts[p]+(p%2?P.y:P.x));S+=cp.momentForPoly(n*b[a],fverts,P),this.cpShapes.push(new cp.PolyShape(null,fverts,P)),this.polylist.push(x)}var w=this.area*n;this.cpBody=new cp.Body(w,S);for(var a=0;a<this.cpShapes.length;a++)this.cpShapes[a].setBody(this.cpBody),this.cpShapes[a].setElasticity(o),this.cpShapes[a].setFriction(r),this.cpShapes[a].setCollisionType(COLTYPE_SOLID),this.cpShapes[a].name=t,e.addShape(this.cpShapes[a]);this.cpBody.setPos(new cp.v(m[0],m[1])),e.addBody(this.cpBody)}var C=this.polylist.map(y);this.outline=d(C)},PGCompound.prototype=Object.create(PGObject.prototype),PGCompound.prototype.getPolys=function(){var t=[];if(this.isStatic())for(var e=0;e<this.polylist.length;e++){for(var i=[],n=0;n<this.polylist[e].length;n+=2)i.push([this.polylist[e][n],this.polylist[e][n+1]]);t.push(i)}else for(var o=this.getPos(),r=this.getRot(),e=0;e<this.polylist.length;e++){for(var i=[],n=0;n<this.polylist[e].length;n+=2){var s=x([this.polylist[e][n],this.polylist[e][n+1]],r);i.push([s[0]+o[0],s[1]+o[1]])}t.push(i)}return t},PGCompound.prototype.getOutline=function(){if(this.isStatic())return this.outline;var t=this.getPos(),e=this.getRot(),i=function(i){return i=x(i,e),[i[0]+t[0],i[1]+t[1]]};return this.outline.map(i)},PGCompound.prototype._exposeShapes=function(){return this.cpShapes},PGGoal=function(t,e,i,n){n="undefined"!=typeof n?n:DEFAULT_GOAL_COLOR;for(var o=[],r=0;r<i.length;r++){var s=i[r];o.push(s[0]),o.push(s[1])}PGObject.call(this,t,"Goal",e,n,0,0,0),this.cpBody=null,this.cpShape=new cp.PolyShape(e.staticBody,o,cp.vzero),this.cpShape.sensor=!0,this.cpShape.setCollisionType(COLTYPE_SENSOR),this.cpShape.name=t,e.addShape(this.cpShape)},PGGoal.prototype=Object.create(PGObject.prototype),PGGoal.prototype.getVertices=function(){for(var t=[],e=0;e<this.cpShape.verts.length-1;e+=2){var i=[this.cpShape.verts[e],this.cpShape.verts[e+1]];t.push(i)}return t},PGGoal.prototype.pointIn=function(t){var e=new cp.v(t[0],t[1]);return this.cpShape.pointQuery(e)},PGBlocker=function(t,e,i,n){for(var o=[],r=0;r<i.length;r++){var s=i[r];o.push(s[0]),o.push(s[1])}PGObject.call(this,t,"Blocker",e,n,0,0,0),this.cpBody=null,this.cpShape=new cp.PolyShape(e.staticBody,o,cp.vzero),this.cpShape.sensor=!0,this.cpShape.setCollisionType(COLTYPE_BLOCKED),this.cpShape.name=t,e.addShape(this.cpShape)},PGBlocker.prototype=Object.create(PGObject.prototype),PGBlocker.prototype.getVertices=function(){for(var t=[],e=0;e<this.cpShape.verts.length-1;e+=2){var i=[this.cpShape.verts[e],this.cpShape.verts[e+1]];t.push(i)}return t},PGBlocker.prototype.pointIn=function(t){var e=new cp.v(t[0],t[1]);return this.cpShape.pointQuery(e)},PGCond_AnyInGoal=function(t,e,i,n){var n="undefined"!=typeof n?n:[];this.type="AnyInGoal",this.won=!1,this.goal=t,this.excl=n,this.dur=e,this.ins={},this.hasTime=!0,this.parent=i},PGCond_AnyInGoal.prototype._goesIn=function(t,e,i){e.name!==i.goal||t.name in i.ins||i.excl.indexOf(t.name)!==-1||(i.ins[t.name]=i.parent.time)},PGCond_AnyInGoal.prototype._goesOut=function(t,e,i){e.name===i.goal&&t.name in i.ins&&!e.pointIn(t.getPos())&&delete i.ins[t.name]},PGCond_AnyInGoal.prototype.attachHooks=function(){var t=this;t.parent.setGoalCollisionBegin(function(e,i){t._goesIn(e,i,t)}),t.parent.setGoalCollisionEnd(function(e,i){t._goesOut(e,i,t)})},PGCond_AnyInGoal.prototype.remainingTime=function(){if(0===Object.keys(this.ins).length)return null;var t=this.parent.time;for(var e in this.ins)this.ins[e]<t&&(t=this.ins[e]);var i=this.parent.time-t;return Math.max(this.dur-i,0)},PGCond_AnyInGoal.prototype.isWon=function(){return 0===this.remainingTime()},PGCond_SpecificInGoal=function(t,e,i,n){this.type="SpecificInGoal",this.won=!1,this.goal=t,this.obj=e,this.dur=i,this.tin=0,this.hasTime=!0,this.parent=n},PGCond_SpecificInGoal.prototype._goesIn=function(t,e,i){e.name===i.goal&&t.name===i.obj&&(i.tin=i.parent.time)},PGCond_SpecificInGoal.prototype._goesOut=function(t,e,i){e.name!==i.goal||t.name!==i.obj||e.pointIn(t.getPos())||(i.tin=0)},PGCond_SpecificInGoal.prototype.attachHooks=function(){var t=this;t.parent.setGoalCollisionBegin(function(e,i){t._goesIn(e,i,t)}),t.parent.setGoalCollisionEnd(function(e,i){t._goesOut(e,i,t)})},PGCond_SpecificInGoal.prototype.remainingTime=function(){if(0===this.tin)return null;var t=this.parent.time-this.tin;return Math.max(this.dur-t,0)},PGCond_SpecificInGoal.prototype.isWon=function(){return 0===this.remainingTime()},PGCond_ManyInGoal=function(t,e,i,n){this.type="ManyInGoal",this.won=!1,this.goal=t,this.objlist=e,this.objsin=[],this.dur=i,this.tin=0,this.hasTime=!0,this.parent=n},PGCond_ManyInGoal.prototype._goesIn=function(t,e,i){e.name===i.goal&&i.objlist.indexOf(t.name)!==-1&&i.objsin.indexOf(t.name)===-1&&(i.objsin.push(t.name),1===i.objsin.length&&(i.tin=i.parent.time))},PGCond_ManyInGoal.prototype._goesOut=function(t,e,i){var n=i.objsin.indexOf(t.name);e.name===i.goal&&n!==-1&&(i.objsin.splice(n,1),0===i.objsin.length&&(i.tin=0))},PGCond_ManyInGoal.prototype.attachHooks=function(){var t=this;t.parent.setGoalCollisionBegin(function(e,i){t._goesIn(e,i,t)}),t.parent.setGoalCollisionEnd(function(e,i){t._goesOut(e,i,t)})},PGCond_ManyInGoal.prototype.remainingTime=function(){if(0===this.tin)return null;var t=this.parent.time-this.tin;return Math.max(this.dur-t,0)},PGCond_ManyInGoal.prototype.isWon=function(){return 0===this.remainingTime()},PGCond_AnyTouch=function(t,e,i){this.type="AnyTouch",this.won=!1,this.goal=t,this.dur=e,this.tin=0,this.hasTime=!0,this.parent=i},PGCond_AnyTouch.prototype._beginTouch=function(t,e,i){t.name===i.goal|e.name===i.goal&&(i.tin=i.parent.time)},PGCond_AnyTouch.prototype._endTouch=function(t,e,i){t.name===i.goal|e.name===i.goal&&(i.tin=0)},PGCond_AnyTouch.prototype.attachHooks=function(){var t=this;t.parent.setSolidCollisionBegin(function(e,i){t._beginTouch(e,i,t)}),t.parent.setSolidCollisionEnd(function(e,i){t._endTouch(e,i,t)})},PGCond_AnyTouch.prototype.remainingTime=function(){if(0===this.tin)return null;var t=this.parent.time-this.tin;return Math.max(this.dur-t,0)},PGCond_AnyTouch.prototype.isWon=function(){return 0===this.remainingTime()},PGCond_SpecificTouch=function(t,e,i,n){this.type="SpecificTouch",this.won=!1,this.o1=t,this.o2=e,this.dur=i,this.tin=0,this.hasTime=!0,this.parent=n},PGCond_SpecificTouch.prototype._beginTouch=function(t,e,i){t.name===i.o1&e.name===i.o2|t.name===i.o2&e.name===i.o1&&(i.tin=i.parent.time)},PGCond_SpecificTouch.prototype._endTouch=function(t,e,i){t.name===i.o1&e.name===i.o2|t.name===i.o2&e.name===i.o1&&(i.tin=0)},PGCond_SpecificTouch.prototype.attachHooks=function(){var t=this;t.parent.setSolidCollisionBegin(function(e,i){t._beginTouch(e,i,t)}),t.parent.setSolidCollisionEnd(function(e,i){t._endTouch(e,i,t)})},PGCond_SpecificTouch.prototype.remainingTime=function(){if(0===this.tin)return null;var t=this.parent.time-this.tin;return Math.max(this.dur-t,0)},PGCond_SpecificTouch.prototype.isWon=function(){return 0===this.remainingTime()},PGWorld=function(t,e,i,n,r,a,h,c,p,l){var n="undefined"!=typeof n?n:.01,i="undefined"!=typeof i?i:[!0,!0,!0,!0];this.def_density="undefined"!=typeof r?r:DEFAULT_DENSITY,this.def_elasticity="undefined"!=typeof a?a:DEFAULT_ELASTICITY,this.def_friction="undefined"!=typeof h?h:DEFAULT_FRICTION,this.bk_col="undefined"!=typeof c?c:"white",this.def_col="undefined"!=typeof p?p:DEFAULT_COLOR,this.def_goal_col="undefined"!=typeof l?l:DEFAULT_GOAL_COLOR,o(4===i.length,"closed_ends must be a length 4 boolean array (l,b,r,t)"),this.dims=t,this.bts=n,this.time=0,this.hasPlaceCollision=!1,this.cpSpace=new cp.Space,this.cpSpace.gravity=new cp.v(0,-e),this.objects={},this.blockers={},this.constraints={},this.goalCond=null,this.winCallback=null,this._collisionEvents=[],this.ssBegin=s,this.ssPre=s,this.ssPost=s,this.ssEnd=s,this.sgBegin=s,this.sgEnd=s,me=this,this.cpSpace.addCollisionHandler(COLTYPE_SOLID,COLTYPE_SOLID,function(t,e){return v(t,e,me)},function(t,e){return b(t,e,me)},function(t,e){return g(t,e,me)},function(t,e){return _(t,e,me)}),this.cpSpace.addCollisionHandler(COLTYPE_PLACED,COLTYPE_SOLID,function(t,e){return v(t,e,me)},function(t,e){return b(t,e,me)},function(t,e){return g(t,e,me)},function(t,e){return _(t,e,me)}),this.cpSpace.addCollisionHandler(COLTYPE_SOLID,COLTYPE_SENSOR,function(t,e){return m(t,e,me)},null,null,function(t,e){return S(t,e,me)}),this.cpSpace.addCollisionHandler(COLTYPE_PLACED,COLTYPE_SENSOR,function(t,e){return m(t,e,me)},null,null,function(t,e){return S(t,e,me)}),i[0]&&this.addBox("_LeftWall",[-1,-1,1,this.dims[1]+1],this.def_col,0),i[1]&&this.addBox("_BottomWall",[-1,-1,this.dims[0]+1,1],this.def_col,0),i[2]&&this.addBox("_RightWall",[this.dims[0]-1,-1,this.dims[0]+1,this.dims[1]+1],this.def_col,0),i[3]&&this.addBox("_TopWall",[-1,this.dims[1]-1,this.dims[0]+1,this.dims[1]+1],this.def_col,0)},PGWorld.prototype.step=function(t){var e=Math.floor(t/this.bts),i=this.bts%t;this.time+=t;for(var n=0;n<e;n++)this.cpSpace.step(this.bts),this.checkEnd()&&null!==this.winCallback&&this.winCallback();this.cpSpace.step(i),this.checkEnd()&&null!==this.winCallback&&this.winCallback()},PGWorld.prototype._invert=function(t){return[t[0],this.dims[1]-t[1]]},PGWorld.prototype._yinvert=function(t){return this.dims[1]-t},PGWorld.prototype._drawSeg=function(t,e,i,n,o){t.fillStyle=o,t.strokeStyle=o,t.lineWidth=1,t.beginPath(),t.arc(e[0],e[1],n,0,2*Math.PI),t.fill(),t.lineWidth=2*n,t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(i[0],i[1]),t.stroke(),t.lineWidth=1,t.beginPath(),t.arc(i[0],i[1],n,0,2*Math.PI),t.fill()},PGWorld.prototype._drawPoly=function(t,e,i,n){"undefined"==typeof n&&(n=0),t.fillStyle=i,t.strokeStyle=i,t.lineWidth=n,t.beginPath(),t.moveTo(e[0][0],this._yinvert(e[0][1]));for(var o=1;o<e.length;o++)t.lineTo(e[o][0],this._yinvert(e[o][1]));t.closePath(),0===n&&t.fill(),t.stroke()},PGWorld.prototype.draw=function(t){var e=.4,i=2,n=t.getContext("2d");n.globalCompositeOperation;n.globalCompositeOperation="source-over",n.fillStyle=this.bk_col,n.fillRect(0,0,this.dims[0],this.dims[1]);for(var o in this.blockers){var r=this.blockers[o],s=r.getVertices();n.fillStyle=r.color,n.beginPath(),n.moveTo(s[0][0],this._invert(s[0])[1]);for(var a=1;a<s.length;a++){var h=this._invert(s[a]);n.lineTo(h[0],h[1])}n.closePath(),n.fill()}var p=[];for(var l in this.objects){var u=this.objects[l];if("Poly"===u.type){var s=u.getVertices();this._drawPoly(n,s,c(u.color,e)),this._drawPoly(n,s,u.color,i)}else if("Ball"===u.type){var d=this._invert(u.getPos()),y=u.getRadius();n.fillStyle=c(u.color,e),n.strokeStyle=u.color,n.lineWidth=i,n.beginPath(),n.arc(d[0],d[1],y,0,2*Math.PI),n.fill(),n.stroke();for(var f=-u.getRot(),v=u.color,b=u.getPos(),g=0;g<5;g++){var _=g*Math.PI/2.5+f,m=[[.6*y*Math.sin(_)+b[0],.6*y*Math.cos(_)+b[1]],[.7*y*Math.sin(_)+b[0],.7*y*Math.cos(_)+b[1]],[.7*y*Math.sin(_+Math.PI/15)+b[0],.7*y*Math.cos(_+Math.PI/15)+b[1]],[.6*y*Math.sin(_+Math.PI/15)+b[0],.6*y*Math.cos(_+Math.PI/15)+b[1]]];this._drawPoly(n,m,v)}}else if("Segment"===u.type){var m=u.getPoints();m=[this._invert(m[0]),this._invert(m[1])],this._drawSeg(n,m[0],m[1],u.r,u.color)}else if("Container"===u.type){for(var S=u.getPolys(),a=0;a<S.length;a++)this._drawPoly(n,S[a],c(u.outerColor,e));this._drawPoly(n,u.getOutline(),u.outerColor,i),null!==u.innerColor&&p.push({vertices:u.getVertices(),color:u.innerColor})}else if("Compound"===u.type){for(var S=u.getPolys(),a=0;a<S.length;a++)this._drawPoly(n,S[a],c(u.color,e));this._drawPoly(n,u.getOutline(),u.color,i)}else if("Goal"===u.type){var s=u.getVertices();if(null!==u.color){var x=c(u.color,e);p.push({vertices:s,color:x})}}else console.log("Error: invalid object type for drawing")}for(var a=0;a<p.length;a++){var s=p[a].vertices,x=p[a].color,P=n.globalAlpha;n.globalAlpha=.5,this._drawPoly(n,s,x),n.globalAlpha=P}},PGWorld.prototype.checkEnd=function(){return null!==this.goalCond&&this.goalCond.isWon()},PGWorld.prototype.getObject=function(t){return o(t in this.objects,"No object by that name: "+t),this.objects[t]},PGWorld.prototype.getGravity=function(){return-this.cpSpace.gravity.y},PGWorld.prototype.setGravity=function(t){var e=new cp.v(0,-t);this.cpSpace.gravity=e},PGWorld.prototype.addPoly=function(t,e,i,n,r,s){o(!(t in this.objects),"Name already taken: "+t);var n="undefined"!=typeof n?n:this.def_density,r="undefined"!=typeof r?r:this.def_elasticity,s="undefined"!=typeof s?s:this.def_friction,a=new PGPoly(t,this.cpSpace,e,n,r,s,i);return this.objects[t]=a,a},PGWorld.prototype.addBox=function(t,e,i,n,r,s){o(!(t in this.objects),"Name already taken"),o(4===e.length,"Need four numbers for bounds [l,b,r,t]");var n="undefined"!=typeof n?n:this.def_density,a="undefined"!=typeof a?a:this.def_elasticity,s="undefined"!=typeof s?s:this.def_friction,h=e[0],c=e[1],p=e[2],l=e[3],u=[[h,c],[h,l],[p,l],[p,c]],d=new PGPoly(t,this.cpSpace,u,n,a,s,i);return this.objects[t]=d,d},PGWorld.prototype.addBall=function(t,e,i,n,r,s,a){o(!(t in this.objects),"Name already taken");var r="undefined"!=typeof r?r:this.def_density,s="undefined"!=typeof s?s:this.def_elasticity,a="undefined"!=typeof a?a:this.def_friction,h=new PGBall(t,this.cpSpace,e,i,r,s,a,n);return this.objects[t]=h,h},PGWorld.prototype.addSegment=function(t,e,i,n,r,s,a,h){o(!(t in this.objects),"Name already taken");var s="undefined"!=typeof s?s:this.def_density,a="undefined"!=typeof a?a:this.def_elasticity,h="undefined"!=typeof h?h:this.def_friction,c=new PGSeg(t,this.cpSpace,e,i,n,s,a,h,r);return this.objects[t]=c,c},PGWorld.prototype.addContainer=function(t,e,i,n,r,s,a,h){o(!(t in this.objects),"Name already taken"),s="undefined"!=typeof s?s:this.def_density,a="undefined"!=typeof a?a:this.def_elasticity,h="undefined"!=typeof h?h:this.def_friction,n="undefined"!=typeof n?n:this.def_goal_col,r="undefined"!=typeof r?r:this.def_col;var c=new PGContainer(t,this.cpSpace,e,i,s,a,h,n,r);return this.objects[t]=c,c},PGWorld.prototype.addCompound=function(t,e,i,n,r,s){o(!(t in this.objects),"Name already taken");var n="undefined"!=typeof n?n:this.def_density,r="undefined"!=typeof r?r:this.def_elasticity,s="undefined"!=typeof s?s:this.def_friction,a=new PGCompound(t,this.cpSpace,e,n,r,s,i);return this.objects[t]=a,a},PGWorld.prototype.addPolyGoal=function(t,e,i){o(!(t in this.objects),"Name already taken");var n=new PGGoal(t,this.cpSpace,e,i);return this.objects[t]=n,n},PGWorld.prototype.addBoxGoal=function(t,e,i){o(!(t in this.objects),"Name already taken");var n=e[0],r=e[1],s=e[2],a=e[3],h=[[n,r],[n,a],[s,a],[s,r]],c=new PGGoal(t,this.cpSpace,h,i);return this.objects[t]=c,c},PGWorld.prototype.addPlacedPoly=function(t,e,i,n,o,r){var s=this.addPoly(t,e,i,n,o,r);return s.cpShape.setCollisionType(COLTYPE_PLACED),s},PGWorld.prototype.addPlacedCompound=function(t,e,i,n,o,r){for(var s=this.addCompound(t,e,i,n,o,r),a=0;a<s.cpShapes.length;a++)s.cpShapes[a].setCollisionType(COLTYPE_PLACED);return s},PGWorld.prototype.addBlock=function(t,e,i){o(!(t in this.blockers),"Name already taken"),o(4===e.length,"Need four numbers for bounds [l,b,r,t]");var n=e[0],r=e[1],s=e[2],a=e[3],h=[[n,r],[n,a],[s,a],[s,r]],c=new PGBlocker(t,this.cpSpace,h,i);return this.blockers[t]=c,c},PGWorld.prototype.addPolyBlock=function(t,e,i){o(!(t in this.blockers),"Name already taken");var n=new PGBlocker(t,this.cpSpace,e,i);return this.blockers[t]=n,n},PGWorld.prototype.setSolidCollisionPre=function(t){var t="undefined"!=typeof t?t:s;o(r(t),"Must pass legal function to callback setter"),this.ssPre=t},PGWorld.prototype.setSolidCollisionPost=function(t){var t="undefined"!=typeof t?t:s;o(r(t),"Must pass legal function to callback setter"),this.ssPost=t},PGWorld.prototype.setSolidCollisionBegin=function(t){var t="undefined"!=typeof t?t:s;o(r(t),"Must pass legal function to callback setter"),this.ssBegin=t},PGWorld.prototype.setSolidCollisionEnd=function(t){var t="undefined"!=typeof t?t:s;o(r(t),"Must pass legal function to callback setter"),this.ssEnd=t},PGWorld.prototype.setGoalCollisionBegin=function(t){var t="undefined"!=typeof t?t:s;o(r(t),"Must pass legal function to callback setter"),this.sgBegin=t},PGWorld.prototype.setGoalCollisionEnd=function(t){var t="undefined"!=typeof t?t:s;o(r(t),"Must pass legal function to callback setter"),this.sgEnd=t},PGWorld.prototype._solidSolidPre=function(t,e,i){var n=f(t,e),o=i.getObject(n[0]),r=i.getObject(n[1]);i.ssPre(o,r)},PGWorld.prototype._solidSolidPost=function(t,e,i){var n=f(t,e),o=i.getObject(n[0]),r=i.getObject(n[1]);i.ssPost(o,r)},PGWorld.prototype._solidSolidBegin=function(t,e,i){var n=f(t,e),o=i.getObject(n[0]),r=i.getObject(n[1]);o.isStatic()&&r.isStatic()||i._collisionEvents.push([n[0],n[1],"begin",i.time,w(t)]),i.ssBegin(o,r)},PGWorld.prototype._solidSolidEnd=function(t,e,i){var n=f(t,e),o=i.getObject(n[0]),r=i.getObject(n[1]);o.isStatic()&&r.isStatic()||i._collisionEvents.push([n[0],n[1],"end",i.time,w(t)]),i.ssEnd(o,r)},PGWorld.prototype._solidGoalBegin=function(t,e,i){var n=f(t,e),o=i.getObject(n[0]),r=i.getObject(n[1]);i.sgBegin(o,r)},PGWorld.prototype._solidGoalEnd=function(t,e,i){var n=f(t,e),o=i.getObject(n[0]),r=i.getObject(n[1]);i.sgEnd(o,r)},PGWorld.prototype.callbackOnWin=function(t){o(r(t),"Must pass legal function to callback setter"),this.winCallback=t},PGWorld.prototype.attachAnyInGoal=function(t,e,i){var n=this;this.goalCond=new PGCond_AnyInGoal(t,e,n,i),this.goalCond.attachHooks()},PGWorld.prototype.attachSpecificInGoal=function(t,e,i){var n=this;this.goalCond=new PGCond_SpecificInGoal(t,e,i,n),this.goalCond.attachHooks()},PGWorld.prototype.attachManyInGoal=function(t,e,i){var n=this;this.goalCond=new PGCond_ManyInGoal(t,e,i,n),this.goalCond.attachHooks()},PGWorld.prototype.attachAnyTouch=function(t,e){var i=this;this.goalCond=new PGCond_AnyTouch(t,e,i),this.goalCond.attachHooks()},PGWorld.prototype.attachSpecificTouch=function(t,e,i){var n=this;this.goalCond=new PGCond_SpecificTouch(t,e,i,n),this.goalCond.attachHooks()},PGWorld.prototype.checkFinishers=function(){return null!==this.goalCond&&null!==this.winCallback},PGWorld.prototype.resetCollisions=function(){this._collisionEvents=[]},PGWorld.prototype.getCollisionEvents=function(){return this._collisionEvents},PGWorld.prototype._hitOnPlacementCollision=function(t){
return t.hasPlaceCollision=!0,!1},PGWorld.prototype.checkCollision=function(t,e){for(var i=[],n=0;n<e.length;n++)i.push(t[0]+e[n][0],t[1]+e[n][1]);var o=new cp.Body(1,1),r=new cp.PolyShape(o,i,cp.vzero);r.setCollisionType(COLTYPE_CHECKER),r.sensor=!0,this.hasPlaceCollision=!1,me=this,this.cpSpace.shapeQuery(r,function(){me._hitOnPlacementCollision(me)});var s=this.hasPlaceCollision;return this.hasPlaceCollision=!1,s},PGWorld.prototype.toDict=function(){var t={};t.dims=this.dims,t.bts=this.bts,t.gravity=this.getGravity(),t.defaults={density:this.def_density,friction:this.def_friction,elasticity:this.def_elasticity,color:this.def_col,bk_color:this.bk_col},t.objects={};for(var e in this.objects){var i=this.objects[e],o={type:i.type,color:i.color,density:i.density,friction:i.friction,elasticity:i.elasticity};if("Poly"===i.type)o.vertices=i.getVertices();else if("Ball"===i.type)o.position=i.getPos(),o.radius=i.getRadius();else if("Segment"===i.type){var r=i.getPoints();o.p1=r[0],o.p2=r[1],o.width=2*i.r}else if("Container"===i.type)o.points=i.getVertices(),o.width=2*i.r,o.innerColor=i.innerColor,o.outerColor=i.outerColor;else if("Goal"===i.type)o.vertices=i.getVertices();else{if("Compound"!==i.type)throw new n("Illegal object type encountered: "+i.type);o.polys=i.getPolys()}t.objects[e]=o}t.blocks={};for(var e in this.blockers){var s=this.blockers[e],o={color:s.color,vertices:s.getVertices()};t.blocks[e]=o}if(t.constraints={},null===this.goalCond)t.gcond=null;else if("AnyInGoal"===this.goalCond.type)t.gcond={type:"AnyInGoal",goal:this.goalCond.goal,obj:"-",exclusions:this.goalCond.excl,duration:this.goalCond.dur};else if("SpecificInGoal"===this.goalCond.type)t.gcond={type:"SpecificInGoal",goal:this.goalCond.goal,obj:this.goalCond.obj,duration:this.goalCond.dur};else if("AnyTouch"===this.goalCond.type)t.gcond={type:"AnyTouch",goal:this.goalCond.goal,obj:"-",duration:this.goalCond.dur};else if("SpecificTouch"===this.goalCond.type)t.gcond={type:"SpecificTouch",obj:this.goalCond.o1,goal:this.goalCond.o2,duration:this.goalCond.dur};else{if("ManyInGoal"!==this.goalCond.type)throw new n("Illegal goal condition type encountered: "+this.goalCond.type);t.gcond={type:"ManyInGoal",objlist:this.goalCond.objlist,goal:this.goalCond.goal,duration:this.goalCond.dur}}return t};var k=function(t){var e=t,i=new PGWorld(e.dims,e.gravity,[!1,!1,!1,!1],e.bts,e.defaults.density,e.defaults.elasticity,e.defaults.friction,e.defaults.bk_col,e.defaults.color);for(var o in e.objects){var r=e.objects[o];if("Poly"===r.type)i.addPoly(o,r.vertices,r.color,r.density,r.elasticity,r.friction);else if("Ball"===r.type)i.addBall(o,r.position,r.radius,r.color,r.density,r.elasticity,r.friction);else if("Segment"===r.type)i.addSegment(o,r.p1,r.p2,r.width,r.color,r.density,r.elasticity,r.friction);else if("Container"===r.type)i.addContainer(o,r.points,r.width,r.innerColor,r.outerColor,r.density,r.elasticity,r.friction);else if("Goal"===r.type)i.addPolyGoal(o,r.vertices,r.color);else{if("Compound"!==r.type)throw new n("Illegal object type encountered: "+r.type);i.addCompound(o,r.polys,r.color,r.density,r.elasticity,r.friction)}}for(var o in e.blocks){var s=e.blocks[o];i.addPolyBlock(o,s.vertices,s.color)}if(null!==e.gcond){var a=e.gcond;if("AnyInGoal"===a.type)i.attachAnyInGoal(a.goal,a.duration,a.exclusions);else if("SpecificInGoal"===a.type)i.attachSpecificInGoal(a.goal,a.obj,a.duration);else if("AnyTouch"===a.type)i.attachAnyTouch(a.goal,a.duration);else if("SpecificTouch"===a.type)i.attachSpecificTouch(a.goal,a.obj,a.duration);else{if("ManyInGoal"!==a.type)throw new n("Illegal goal condition type encountered: "+a.type);i.attachManyInGoal(a.goal,a.objlist,a.duration)}}return i};e.exports={World:PGWorld,assert:o,isFunction:r,loadFromDict:k,coltype_solid:COLTYPE_SOLID,coltype_sensor:COLTYPE_SENSOR,coltype_placed:COLTYPE_PLACED,coltype_blocked:COLTYPE_BLOCKED,coltype_checker:COLTYPE_CHECKER}},{chipmunk:2,"color-convert":4}],2:[function(t,e,i){!function(){Object.create=Object.create||function(t){function e(){}return e.prototype=t,new e};var t;"undefined"==typeof i?(t={},"object"==typeof window&&(window.cp=t)):t=i;var e,n,o=function(t,e){if(!t)throw new Error("Assertion failed: "+e)},r=function(t,e){!t&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+e),console.trace&&console.trace())},s=function(t,e){return t<e?t:e},a=function(t,e){return t>e?t:e};"object"==typeof window&&window.navigator.userAgent.indexOf("Firefox")>-1?(e=Math.min,n=Math.max):(e=s,n=a);var h=function(t,e){return t<e?t+" "+e:e+" "+t},c=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return t[i]=t[t.length-1],void t.length--},p=function(t,e,i){var n=B(e,i),o=_(P(n,B(t,i))/F(n));return j(i,G(n,o))},l=function(t,e,i,n,o,r){var s=i-o,a=n-r,h=_(w(s,a,t-o,e-r)/D(s,a));return new S(o+s*h,r+a*h)},u=(t.momentForCircle=function(t,e,i,n){return t*(.5*(e*e+i*i)+F(n))},t.areaForCircle=function(t,e){return Math.PI*Math.abs(t*t-e*e)},t.momentForSegment=function(t,e,i){var n=G(j(e,i),.5);return t*(q(i,e)/12+F(n))},t.areaForSegment=function(t,e,i){return i*(Math.PI*i+2*Y(t,e))},t.momentForPoly=function(t,e,i){for(var n=0,o=0,r=e.length,s=0;s<r;s+=2){var a=e[s]+i.x,h=e[s+1]+i.y,c=e[(s+2)%r]+i.x,p=e[(s+3)%r]+i.y,l=I(c,p,a,h),u=w(a,h,a,h)+w(a,h,c,p)+w(c,p,c,p);n+=l*u,o+=l}return t*n/(6*o)},t.areaForPoly=function(t){for(var e=0,i=0,n=t.length;i<n;i+=2)e+=M(new S(t[i],t[i+1]),new S(t[(i+2)%n],t[(i+3)%n]));return-e/2},t.centroidForPoly=function(t){for(var e=0,i=new S(0,0),n=0,o=t.length;n<o;n+=2){var r=new S(t[n],t[n+1]),s=new S(t[(n+2)%o],t[(n+3)%o]),a=M(r,s);e+=a,i=j(i,G(j(r,s),a))}return G(i,1/(3*e))}),d=(t.recenterPoly=function(t){for(var e=u(t),i=0;i<t.length;i+=2)t[i]-=e.x,t[i+1]-=e.y},t.momentForBox=function(t,e,i){return t*(e*e+i*i)/12}),y=(t.momentForBox2=function(t,e){return width=e.r-e.l,height=e.t-e.b,offset=G([e.l+e.r,e.b+e.t],.5),d(t,width,height)+t*F(offset)},t.loopIndexes=function(t){var e,i,n,o,r=0,s=0;e=n=t[0],i=o=t[1];for(var a=t.length>>1,h=1;h<a;h++){var c=t[2*h],p=t[2*h+1];c<e||c==e&&p<i?(e=c,i=p,r=h):(c>n||c==n&&p>o)&&(n=c,o=p,s=h)}return[r,s]}),f=function(t,e,i){var n=t[2*e];t[2*e]=t[2*i],t[2*i]=n,n=t[2*e+1],t[2*e+1]=t[2*i+1],t[2*i+1]=n},v=function(t,e,i,n,o,r){if(0===i)return 0;for(var s=0,a=e,h=B(o,n),c=r*C(h),p=e,l=e+i-1;p<=l;){var u=new S(t[2*p],t[2*p+1]),d=M(h,B(u,n));d>c?(d>s&&(s=d,a=p),p++):(f(t,p,l),l--)}return a!=e&&f(t,e,a),p-e},b=function(t,e,i,n,o,r,s,a){if(n<0)return 0;if(0==n)return e[2*a]=r.x,e[2*a+1]=r.y,1;var h=v(e,i,n,o,r,t),c=new S(e[2*i],e[2*i+1]),p=b(t,e,i+1,h-1,o,c,r,a),l=a+p++;e[2*l]=r.x,e[2*l+1]=r.y;var u=v(e,i+h,n-h,r,s,t),d=new S(e[2*(i+h)],e[2*(i+h)+1]);return p+b(t,e,i+h+1,u-1,r,d,s,a+p)},g=(t.convexHull=function(t,e,i){if(e)for(var n=0;n<t.length;n++)e[n]=t[n];else e=t;var o=y(t),s=o[0],a=o[1];if(s==a)return e.length=2,e;f(e,0,s),f(e,1,0==a?s:a);var h=new S(e[0],e[1]),c=new S(e[2],e[3]),p=t.length>>1,l=b(i,e,2,p-2,h,c,h,1)+1;return e.length=2*l,r(ot(e),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),e},function(t,i,o){return e(n(t,i),o)}),_=function(t){return n(0,e(t,1))},m=0,S=t.Vect=function(t,e){this.x=t,this.y=e,m++};t.v=function(t,e){return new S(t,e)};var x=t.vzero=new S(0,0),P=t.v.dot=function(t,e){return t.x*e.x+t.y*e.y},w=function(t,e,i,n){return t*i+e*n},C=t.v.len=function(t){return Math.sqrt(P(t,t))},A=t.v.len2=function(t,e){return Math.sqrt(t*t+e*e)},j=(t.v.eql=function(t,e){return t.x===e.x&&t.y===e.y},t.v.add=function(t,e){return new S(t.x+e.x,t.y+e.y)});S.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this};var B=t.v.sub=function(t,e){return new S(t.x-e.x,t.y-e.y)};S.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this};var k=t.v.neg=function(t){return new S(-t.x,-t.y)};S.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var G=t.v.mult=function(t,e){return new S(t.x*e,t.y*e)};S.prototype.mult=function(t){return this.x*=t,this.y*=t,this};var M=t.v.cross=function(t,e){return t.x*e.y-t.y*e.x},I=function(t,e,i,n){return t*n-e*i},O=t.v.perp=function(t){return new S(-t.y,t.x)},T=(t.v.pvrperp=function(t){return new S(t.y,-t.x)},t.v.project=function(t,e){return G(e,P(t,e)/F(e))});S.prototype.project=function(t){return this.mult(P(this,t)/F(t)),this};var L=t.v.rotate=function(t,e){return new S(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)};S.prototype.rotate=function(t){return this.x=this.x*t.x-this.y*t.y,this.y=this.x*t.y+this.y*t.x,this};var E=t.v.unrotate=function(t,e){return new S(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},F=t.v.lengthsq=function(t){return P(t,t)},D=t.v.lengthsq2=function(t,e){return t*t+e*e},N=t.v.lerp=function(t,e,i){return j(G(t,1-i),G(e,i))},R=t.v.normalize=function(t){return G(t,1/C(t))},W=t.v.normalize_safe=function(t){return 0===t.x&&0===t.y?x:R(t)},V=t.v.clamp=function(t,e){return P(t,t)>e*e?G(R(t),e):t},Y=(t.v.lerpconst=function(t,e,i){return j(t,V(B(e,t),i))},t.v.dist=function(t,e){return C(B(t,e))}),q=t.v.distsq=function(t,e){return F(B(t,e))},Q=(t.v.near=function(t,e,i){return q(t,e)<i*i},t.v.slerp=function(t,e,i){var n=Math.acos(P(t,e));if(n){var o=1/Math.sin(n);return j(G(t,Math.sin((1-i)*n)*o),G(e,Math.sin(i*n)*o))}return t}),U=(t.v.slerpconst=function(t,i,n){var o=Math.acos(P(t,i));return Q(t,i,e(n,o)/o)},t.v.forangle=function(t){return new S(Math.cos(t),Math.sin(t))},t.v.toangle=function(t){return Math.atan2(t.y,t.x)},t.v.str=function(t){return"("+t.x.toFixed(3)+", "+t.y.toFixed(3)+")"},0),H=t.BB=function(t,e,i,n){this.l=t,this.b=e,this.r=i,this.t=n,U++};t.bb=function(t,e,i,n){return new H(t,e,i,n)};var z=function(t,e){return new H(t.x-e,t.y-e,t.x+e,t.y+e)},J=function(t,e,i,n,o){return t.l<=n&&e<=t.r&&t.b<=o&&i<=t.t},K=0,X=(t.NO_GROUP=0,t.ALL_LAYERS=-1);t.resetShapeIdCounter=function(){K=0};var Z=t.Shape=function(t){this.body=t,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=K++,this.sensor=!1,this.e=0,this.u=0,this.surface_v=x,this.collision_type=0,this.group=0,this.layers=X,this.space=null,this.collisionCode=this.collisionCode};Z.prototype.setElasticity=function(t){this.e=t},Z.prototype.setFriction=function(t){this.body.activate(),this.u=t},Z.prototype.setLayers=function(t){this.body.activate(),this.layers=t},Z.prototype.setSensor=function(t){this.body.activate(),this.sensor=t},Z.prototype.setCollisionType=function(t){this.body.activate(),this.collision_type=t},Z.prototype.getBody=function(){return this.body},Z.prototype.active=function(){return this.body&&this.body.shapeList.indexOf(this)!==-1},Z.prototype.setBody=function(t){o(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body."),this.body=t},Z.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},Z.prototype.update=function(t,e){o(!isNaN(e.x),"Rotation is NaN"),o(!isNaN(t.x),"Position is NaN"),this.cacheData(t,e)},Z.prototype.pointQuery=function(t){var e=this.nearestPointQuery(t);if(e.d<0)return e},Z.prototype.getBB=function(){return new H(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var $=function(t,e,i){this.shape=t,this.p=e,this.d=i},tt=function(t,e,i){this.shape=t,this.t=e,this.n=i};tt.prototype.hitPoint=function(t,e){return N(t,e,this.t)},tt.prototype.hitDist=function(t,e){return Y(t,e)*this.t};var et=t.CircleShape=function(t,e,i){this.c=this.tc=i,this.r=e,this.type="circle",Z.call(this,t)};et.prototype=Object.create(Z.prototype),et.prototype.cacheData=function(t,e){var i=this.tc=L(this.c,e).add(t),n=this.r;this.bb_l=i.x-n,this.bb_b=i.y-n,this.bb_r=i.x+n,this.bb_t=i.y+n},et.prototype.nearestPointQuery=function(t){var e=t.x-this.tc.x,i=t.y-this.tc.y,n=A(e,i),o=this.r,r=new S(this.tc.x+e*o/n,this.tc.y+i*o/n);return new $(this,r,n-o)};var it=function(t,e,i,n,o,r){n=B(n,e),o=B(o,e);var s=P(n,n)-2*P(n,o)+P(o,o),a=-2*P(n,n)+2*P(n,o),h=P(n,n)-i*i,c=a*a-4*s*h;if(c>=0){var p=(-a-Math.sqrt(c))/(2*s);if(0<=p&&p<=1)return new tt(t,p,R(N(n,o,p)))}};et.prototype.segmentQuery=function(t,e){return it(this,this.tc,this.r,t,e)};var nt=t.SegmentShape=function(t,e,i,n){this.a=e,this.b=i,this.n=O(R(B(i,e))),this.ta=this.tb=this.tn=null,this.r=n,this.a_tangent=x,this.b_tangent=x,this.type="segment",Z.call(this,t)};nt.prototype=Object.create(Z.prototype),nt.prototype.cacheData=function(t,e){this.ta=j(t,L(this.a,e)),this.tb=j(t,L(this.b,e)),this.tn=L(this.n,e);var i,n,o,r;this.ta.x<this.tb.x?(i=this.ta.x,n=this.tb.x):(i=this.tb.x,n=this.ta.x),this.ta.y<this.tb.y?(o=this.ta.y,r=this.tb.y):(o=this.tb.y,r=this.ta.y);var s=this.r;this.bb_l=i-s,this.bb_b=o-s,this.bb_r=n+s,this.bb_t=r+s},nt.prototype.nearestPointQuery=function(t){var e=p(t,this.ta,this.tb),i=t.x-e.x,n=t.y-e.y,o=A(i,n),r=this.r,s=o?j(e,G(new S(i,n),r/o)):e;return new $(this,s,o-r)},nt.prototype.segmentQuery=function(t,e){var i=this.tn,n=P(B(this.ta,t),i),o=this.r,r=n>0?k(i):i,s=B(G(r,o),t),a=j(this.ta,s),h=j(this.tb,s),c=B(e,t);if(M(c,a)*M(c,h)<=0){var p=n+(n>0?-o:o),l=-p,u=P(c,i)-p;if(l*u<0)return new tt(this,l/(l-u),r)}else if(0!==o){var d=it(this,this.ta,this.r,t,e),y=it(this,this.tb,this.r,t,e);return d?y&&y.t<d.t?y:d:y}},nt.prototype.setNeighbors=function(t,e){this.a_tangent=B(t,this.a),this.b_tangent=B(e,this.b)},nt.prototype.setEndpoints=function(t,e){this.a=t,this.b=e,this.n=O(R(B(e,t)))};var ot=function(t){for(var e=t.length,i=0;i<e;i+=2){var n=t[i],o=t[i+1],r=t[(i+2)%e],s=t[(i+3)%e],a=t[(i+4)%e],h=t[(i+5)%e];if(I(r-n,s-o,a-r,h-s)>0)return!1}return!0},rt=t.PolyShape=function(t,e,i){this.setVerts(e,i),this.type="poly",Z.call(this,t)};rt.prototype=Object.create(Z.prototype);var st=function(t,e){this.n=t,this.d=e};st.prototype.compare=function(t){return P(this.n,t)-this.d},rt.prototype.setVerts=function(t,e){o(t.length>=4,"Polygons require some verts"),o("number"==typeof t[0],"Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])"),o(ot(t),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var i=t.length,n=i>>1;this.verts=new Array(i),this.tVerts=new Array(i),this.planes=new Array(n),this.tPlanes=new Array(n);for(var r=0;r<i;r+=2){var s=t[r]+e.x,a=t[r+1]+e.y,h=t[(r+2)%i]+e.x,c=t[(r+3)%i]+e.y,p=R(O(new S(h-s,c-a)));this.verts[r]=s,this.verts[r+1]=a,this.planes[r>>1]=new st(p,w(p.x,p.y,s,a)),this.tPlanes[r>>1]=new st(new S(0,0),0)}};var at=(t.BoxShape=function(t,e,i){var n=e/2,o=i/2;return at(t,new H(-n,-o,n,o))},t.BoxShape2=function(t,e){var i=[e.l,e.b,e.l,e.t,e.r,e.t,e.r,e.b];return new rt(t,i,x)});rt.prototype.transformVerts=function(t,i){for(var o=this.verts,r=this.tVerts,s=1/0,a=-(1/0),h=1/0,c=-(1/0),p=0;p<o.length;p+=2){var l=o[p],u=o[p+1],d=t.x+l*i.x-u*i.y,y=t.y+l*i.y+u*i.x;r[p]=d,r[p+1]=y,s=e(s,d),a=n(a,d),h=e(h,y),c=n(c,y)}this.bb_l=s,this.bb_b=h,this.bb_r=a,this.bb_t=c},rt.prototype.transformAxes=function(t,e){for(var i=this.planes,n=this.tPlanes,o=0;o<i.length;o++){var r=L(i[o].n,e);n[o].n=r,n[o].d=P(t,r)+i[o].d}},rt.prototype.cacheData=function(t,e){this.transformAxes(t,e),this.transformVerts(t,e)},rt.prototype.nearestPointQuery=function(t){for(var e=this.tPlanes,i=this.tVerts,n=i[i.length-2],o=i[i.length-1],r=1/0,s=x,a=!1,h=0;h<e.length;h++){e[h].compare(t)>0&&(a=!0);var c=i[2*h],p=i[2*h+1],u=l(t.x,t.y,n,o,c,p),d=Y(t,u);d<r&&(r=d,s=u),n=c,o=p}return new $(this,s,a?r:-r)},rt.prototype.segmentQuery=function(t,e){for(var i=this.tPlanes,n=this.tVerts,o=i.length,r=2*o,s=0;s<o;s++){var a=i[s].n,h=P(t,a);if(!(i[s].d>h)){var c=P(e,a),p=(i[s].d-h)/(c-h);if(!(p<0||1<p)){var l=N(t,e,p),u=-M(a,l),d=-I(a.x,a.y,n[2*s],n[2*s+1]),y=-I(a.x,a.y,n[(2*s+2)%r],n[(2*s+3)%r]);if(d<=u&&u<=y)return new tt(this,p,a)}}}},rt.prototype.valueOnAxis=function(t,i){for(var n=this.tVerts,o=w(t.x,t.y,n[0],n[1]),r=2;r<n.length;r+=2)o=e(o,w(t.x,t.y,n[r],n[r+1]));return o-i},rt.prototype.containsVert=function(t,e){for(var i=this.tPlanes,n=0;n<i.length;n++){var o=i[n].n,r=w(o.x,o.y,t,e)-i[n].d;if(r>0)return!1}return!0},rt.prototype.containsVertPartial=function(t,e,i){for(var n=this.tPlanes,o=0;o<n.length;o++){var r=n[o].n;if(!(P(r,i)<0)){var s=w(r.x,r.y,t,e)-n[o].d;if(s>0)return!1}}return!0},rt.prototype.getNumVerts=function(){return this.verts.length/2},rt.prototype.getVert=function(t){return new S(this.verts[2*t],this.verts[2*t+1])};var ht=t.Body=function(t,e){this.p=new S(0,0),this.vx=this.vy=0,this.f=new S(0,0),this.w=0,this.t=0,this.v_limit=1/0,this.w_limit=1/0,this.v_biasx=this.v_biasy=0,this.w_bias=0,this.space=null,this.shapeList=[],this.arbiterList=null,this.constraintList=null,this.nodeRoot=null,this.nodeNext=null,this.nodeIdleTime=0,this.setMass(t),this.setMoment(e),this.rot=new S(0,0),this.setAngle(0)};if("undefined"!=typeof DEBUG&&DEBUG){var ct=function(t,e){o(t.x==t.x&&t.y==t.y,e)},pt=function(t,e){o(Math.abs(t.x)!==1/0&&Math.abs(t.y)!==1/0,e)},lt=function(t,e){ct(t,e),pt(t,e)};ht.prototype.sanityCheck=function(){o(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid."),o(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid."),lt(this.p,"Body's position is invalid."),lt(this.f,"Body's force is invalid."),o(this.vx===this.vx&&Math.abs(this.vx)!==1/0,"Body's velocity is invalid."),o(this.vy===this.vy&&Math.abs(this.vy)!==1/0,"Body's velocity is invalid."),o(this.a===this.a&&Math.abs(this.a)!==1/0,"Body's angle is invalid."),o(this.w===this.w&&Math.abs(this.w)!==1/0,"Body's angular velocity is invalid."),o(this.t===this.t&&Math.abs(this.t)!==1/0,"Body's torque is invalid."),lt(this.rot,"Body's rotation vector is invalid."),o(this.v_limit===this.v_limit,"Body's velocity limit is invalid."),o(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else ht.prototype.sanityCheck=function(){};ht.prototype.getPos=function(){return this.p},ht.prototype.getVel=function(){return new S(this.vx,this.vy)},ht.prototype.getAngVel=function(){return this.w},ht.prototype.isSleeping=function(){return null!==this.nodeRoot},ht.prototype.isStatic=function(){return this.nodeIdleTime===1/0},ht.prototype.isRogue=function(){return null===this.space},ht.prototype.setMass=function(t){o(t>0,"Mass must be positive and non-zero."),this.activate(),this.m=t,this.m_inv=1/t},ht.prototype.setMoment=function(t){o(t>0,"Moment of Inertia must be positive and non-zero."),this.activate(),this.i=t,this.i_inv=1/t},ht.prototype.addShape=function(t){this.shapeList.push(t)},ht.prototype.removeShape=function(t){c(this.shapeList,t)};var ut=function(t,e,i){return t===i?t.next(e):(t.a===e?t.next_a=ut(t.next_a,e,i):t.next_b=ut(t.next_b,e,i),t)};ht.prototype.removeConstraint=function(t){this.constraintList=ut(this.constraintList,this,t)},ht.prototype.setPos=function(e){this.activate(),this.sanityCheck(),e===x&&(e=t.v(0,0)),this.p=e},ht.prototype.setVel=function(t){this.activate(),this.vx=t.x,this.vy=t.y},ht.prototype.setAngVel=function(t){this.activate(),this.w=t},ht.prototype.setAngleInternal=function(t){o(!isNaN(t),"Internal Error: Attempting to set body's angle to NaN"),this.a=t,this.rot.x=Math.cos(t),this.rot.y=Math.sin(t)},ht.prototype.setAngle=function(t){this.activate(),this.sanityCheck(),this.setAngleInternal(t)},ht.prototype.velocity_func=function(t,e,i){var n=this.vx*e+(t.x+this.f.x*this.m_inv)*i,o=this.vy*e+(t.y+this.f.y*this.m_inv)*i,r=this.v_limit,s=n*n+o*o,a=s>r*r?r/Math.sqrt(s):1;this.vx=n*a,this.vy=o*a;var h=this.w_limit;this.w=g(this.w*e+this.t*this.i_inv*i,-h,h),this.sanityCheck()},ht.prototype.position_func=function(t){this.p.x+=(this.vx+this.v_biasx)*t,this.p.y+=(this.vy+this.v_biasy)*t,this.setAngleInternal(this.a+(this.w+this.w_bias)*t),this.v_biasx=this.v_biasy=0,this.w_bias=0,this.sanityCheck()},ht.prototype.resetForces=function(){this.activate(),this.f=new S(0,0),this.t=0},ht.prototype.applyForce=function(t,e){this.activate(),this.f=j(this.f,t),this.t+=M(e,t)},ht.prototype.applyImpulse=function(t,e){this.activate(),ye(this,t.x,t.y,e)},ht.prototype.getVelAtPoint=function(t){return j(new S(this.vx,this.vy),G(O(t),this.w))},ht.prototype.getVelAtWorldPoint=function(t){return this.getVelAtPoint(B(t,this.p))},ht.prototype.getVelAtLocalPoint=function(t){return this.getVelAtPoint(L(t,this.rot))},ht.prototype.eachShape=function(t){for(var e=0,i=this.shapeList.length;e<i;e++)t(this.shapeList[e])},ht.prototype.eachConstraint=function(t){for(var e=this.constraintList;e;){var i=e.next(this);t(e),e=i}},ht.prototype.eachArbiter=function(t){for(var e=this.arbiterList;e;){var i=e.next(this);e.swappedColl=this===e.body_b,t(e),e=i}},ht.prototype.local2World=function(t){return j(this.p,L(t,this.rot))},ht.prototype.world2Local=function(t){return E(B(t,this.p),this.rot)},ht.prototype.kineticEnergy=function(){var t=this.vx*this.vx+this.vy*this.vy,e=this.w*this.w;return(t?t*this.m:0)+(e?e*this.i:0)};var dt=t.SpatialIndex=function(t){if(this.staticIndex=t,t){if(t.dynamicIndex)throw new Error("This static index is already associated with a dynamic index.");t.dynamicIndex=this}};dt.prototype.collideStatic=function(t,e){if(t.count>0){var i=t.query;this.each(function(t){i(t,new H(t.bb_l,t.bb_b,t.bb_r,t.bb_t),e)})}};var yt=t.BBTree=function(t){dt.call(this,t),this.velocityFunc=null,this.leaves={},this.count=0,this.root=null,this.pooledNodes=null,this.pooledPairs=null,this.stamp=0};yt.prototype=Object.create(dt.prototype);var ft=0,vt=function(t,i,o){this.obj=null,this.bb_l=e(i.bb_l,o.bb_l),this.bb_b=e(i.bb_b,o.bb_b),this.bb_r=n(i.bb_r,o.bb_r),this.bb_t=n(i.bb_t,o.bb_t),this.parent=null,this.setA(i),this.setB(o)};yt.prototype.makeNode=function(t,e){var i=this.pooledNodes;return i?(this.pooledNodes=i.parent,i.constructor(this,t,e),i):(ft++,new vt(this,t,e))};var bt=0,gt=function(t,e){this.obj=e,t.getBB(e,this),this.parent=null,this.stamp=1,this.pairs=null,bt++};yt.prototype.getBB=function(t,i){var o=this.velocityFunc;if(o){var r=.1,s=(t.bb_r-t.bb_l)*r,a=(t.bb_t-t.bb_b)*r,h=G(o(t),.1);i.bb_l=t.bb_l+e(-s,h.x),i.bb_b=t.bb_b+e(-a,h.y),i.bb_r=t.bb_r+n(s,h.x),i.bb_t=t.bb_t+n(a,h.y)}else i.bb_l=t.bb_l,i.bb_b=t.bb_b,i.bb_r=t.bb_r,i.bb_t=t.bb_t},yt.prototype.getStamp=function(){var t=this.dynamicIndex;return t&&t.stamp?t.stamp:this.stamp},yt.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++};var _t=0,mt=function(t,e,i,n){this.prevA=null,this.leafA=t,this.nextA=e,this.prevB=null,this.leafB=i,this.nextB=n};yt.prototype.makePair=function(t,e,i,n){var o=this.pooledPairs;return o?(this.pooledPairs=o.prevA,o.prevA=null,o.leafA=t,o.nextA=e,o.prevB=null,o.leafB=i,o.nextB=n,o):(_t++,new mt(t,e,i,n))},mt.prototype.recycle=function(t){this.prevA=t.pooledPairs,t.pooledPairs=this};var St=function(t,e,i){i&&(i.leafA===e?i.prevA=t:i.prevB=t),t?t.leafA===e?t.nextA=i:t.nextB=i:e.pairs=i};gt.prototype.clearPairs=function(t){var e,i=this.pairs;for(this.pairs=null;i;)i.leafA===this?(e=i.nextA,St(i.prevB,i.leafB,i.nextB)):(e=i.nextB,St(i.prevA,i.leafA,i.nextA)),i.recycle(t),i=e};var xt=function(t,e,i){var n=t.pairs,o=e.pairs,r=i.makePair(t,n,e,o);t.pairs=e.pairs=r,n&&(n.leafA===t?n.prevA=r:n.prevB=r),o&&(o.leafA===e?o.prevA=r:o.prevB=r)};vt.prototype.recycle=function(t){this.parent=t.pooledNodes,t.pooledNodes=this},gt.prototype.recycle=function(t){},vt.prototype.setA=function(t){this.A=t,t.parent=this},vt.prototype.setB=function(t){this.B=t,t.parent=this},gt.prototype.isLeaf=!0,vt.prototype.isLeaf=!1,vt.prototype.otherChild=function(t){return this.A==t?this.B:this.A},vt.prototype.replaceChild=function(t,i,o){r(t==this.A||t==this.B,"Node is not a child of parent."),this.A==t?(this.A.recycle(o),this.setA(i)):(this.B.recycle(o),this.setB(i));for(var s=this;s;s=s.parent){var a=s.A,h=s.B;s.bb_l=e(a.bb_l,h.bb_l),s.bb_b=e(a.bb_b,h.bb_b),s.bb_r=n(a.bb_r,h.bb_r),s.bb_t=n(a.bb_t,h.bb_t)}},vt.prototype.bbArea=gt.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var Pt=function(t,i){return(n(t.bb_r,i.bb_r)-e(t.bb_l,i.bb_l))*(n(t.bb_t,i.bb_t)-e(t.bb_b,i.bb_b))},wt=function(t,e){return Math.abs(t.bb_l+t.bb_r-e.bb_l-e.bb_r)+Math.abs(t.bb_b+t.bb_t-e.bb_b-e.bb_t)},Ct=function(t,i,o){if(null==t)return i;if(t.isLeaf)return o.makeNode(i,t);var r=t.B.bbArea()+Pt(t.A,i),s=t.A.bbArea()+Pt(t.B,i);return r===s&&(r=wt(t.A,i),s=wt(t.B,i)),s<r?t.setB(Ct(t.B,i,o)):t.setA(Ct(t.A,i,o)),t.bb_l=e(t.bb_l,i.bb_l),t.bb_b=e(t.bb_b,i.bb_b),t.bb_r=n(t.bb_r,i.bb_r),t.bb_t=n(t.bb_t,i.bb_t),t};vt.prototype.intersectsBB=gt.prototype.intersectsBB=function(t){return this.bb_l<=t.r&&t.l<=this.bb_r&&this.bb_b<=t.t&&t.b<=this.bb_t};var At=function(t,e,i){t.intersectsBB(e)&&(t.isLeaf?i(t.obj):(At(t.A,e,i),At(t.B,e,i)))},jt=function(t,i,o){var r=1/(o.x-i.x),s=t.bb_l==i.x?-(1/0):(t.bb_l-i.x)*r,a=t.bb_r==i.x?1/0:(t.bb_r-i.x)*r,h=e(s,a),c=n(s,a),p=1/(o.y-i.y),l=t.bb_b==i.y?-(1/0):(t.bb_b-i.y)*p,u=t.bb_t==i.y?1/0:(t.bb_t-i.y)*p,d=e(l,u),y=n(l,u);if(d<=c&&h<=y){var f=n(h,d),v=e(c,y);if(0<=v&&f<=1)return n(f,0)}return 1/0},Bt=function(t,i,n,o,r){if(t.isLeaf)return r(t.obj);var s=jt(t.A,i,n),a=jt(t.B,i,n);return s<a?(s<o&&(o=e(o,Bt(t.A,i,n,o,r))),a<o&&(o=e(o,Bt(t.B,i,n,o,r)))):(a<o&&(o=e(o,Bt(t.B,i,n,o,r))),s<o&&(o=e(o,Bt(t.A,i,n,o,r)))),o};yt.prototype.subtreeRecycle=function(t){t.isLeaf&&(this.subtreeRecycle(t.A),this.subtreeRecycle(t.B),t.recycle(this))};var kt=function(t,e,i){if(e==t)return null;var n=e.parent;if(n==t){var o=t.otherChild(e);return o.parent=t.parent,t.recycle(i),o}return n.parent.replaceChild(n,n.otherChild(e),i),t},Gt=function(t,e){return t.bb_l<=e.bb_r&&e.bb_l<=t.bb_r&&t.bb_b<=e.bb_t&&e.bb_b<=t.bb_t};gt.prototype.markLeafQuery=function(t,e,i,n){Gt(t,this)&&(e?xt(t,this,i):(this.stamp<t.stamp&&xt(this,t,i),n&&n(t.obj,this.obj)))},vt.prototype.markLeafQuery=function(t,e,i,n){Gt(t,this)&&(this.A.markLeafQuery(t,e,i,n),this.B.markLeafQuery(t,e,i,n))},gt.prototype.markSubtree=function(t,e,i){if(this.stamp==t.getStamp()){e&&e.markLeafQuery(this,!1,t,i);for(var n=this;n.parent;n=n.parent)n==n.parent.A?n.parent.B.markLeafQuery(this,!0,t,i):n.parent.A.markLeafQuery(this,!1,t,i)}else for(var o=this.pairs;o;)this===o.leafB?(i&&i(o.leafA.obj,this.obj),o=o.nextB):o=o.nextA},vt.prototype.markSubtree=function(t,e,i){this.A.markSubtree(t,e,i),this.B.markSubtree(t,e,i)},gt.prototype.containsObj=function(t){return this.bb_l<=t.bb_l&&this.bb_r>=t.bb_r&&this.bb_b<=t.bb_b&&this.bb_t>=t.bb_t},gt.prototype.update=function(t){var e=t.root,i=this.obj;return!this.containsObj(i)&&(t.getBB(this.obj,this),e=kt(e,this,t),t.root=Ct(e,this,t),this.clearPairs(t),this.stamp=t.getStamp(),!0)},gt.prototype.addPairs=function(t){var e=t.dynamicIndex;if(e){var i=e.root;i&&i.markLeafQuery(this,!0,e,null)}else{var n=t.staticIndex.root;this.markSubtree(t,n,null)}},yt.prototype.insert=function(t,e){var i=new gt(this,t);this.leaves[e]=i,this.root=Ct(this.root,i,this),this.count++,i.stamp=this.getStamp(),i.addPairs(this),this.incrementStamp()},yt.prototype.remove=function(t,e){var i=this.leaves[e];delete this.leaves[e],this.root=kt(this.root,i,this),this.count--,i.clearPairs(this),i.recycle(this)},yt.prototype.contains=function(t,e){return null!=this.leaves[e]};var Mt=function(t,e){};yt.prototype.reindexQuery=function(t){if(this.root){var e,i=this.leaves;for(e in i)i[e].update(this);var n=this.staticIndex,o=n&&n.root;this.root.markSubtree(this,o,t),n&&!o&&this.collideStatic(this,n,t),this.incrementStamp()}},yt.prototype.reindex=function(){this.reindexQuery(Mt)},yt.prototype.reindexObject=function(t,e){var i=this.leaves[e];i&&(i.update(this)&&i.addPairs(this),this.incrementStamp())},yt.prototype.pointQuery=function(t,e){this.query(new H(t.x,t.y,t.x,t.y),e)},yt.prototype.segmentQuery=function(t,e,i,n){this.root&&Bt(this.root,t,e,i,n)},yt.prototype.query=function(t,e){this.root&&At(this.root,t,e)},yt.prototype.count=function(){return this.count},yt.prototype.each=function(t){var e;for(e in this.leaves)t(this.leaves[e].obj)};var It=function(t,i,o,r,s){return(n(t.bb_r,r)-e(t.bb_l,i))*(n(t.bb_t,s)-e(t.bb_b,o))},Ot=function(t,i,o,r){if(1==r)return i[o];if(2==r)return t.makeNode(i[o],i[o+1]);for(var s=i[o],a=s.bb_l,h=s.bb_b,c=s.bb_r,p=s.bb_t,l=o+r,u=o+1;u<l;u++)s=i[u],a=e(a,s.bb_l),h=e(h,s.bb_b),c=n(c,s.bb_r),p=n(p,s.bb_t);var d=c-a>p-h,y=new Array(2*r);if(d)for(var u=o;u<l;u++)y[2*u+0]=i[u].bb_l,y[2*u+1]=i[u].bb_r;else for(var u=o;u<l;u++)y[2*u+0]=i[u].bb_b,y[2*u+1]=i[u].bb_t;y.sort(function(t,e){return t-e});var f=.5*(y[r-1]+y[r]),v=a,b=h,g=c,_=p,m=a,S=h,x=c,P=p;d?g=m=f:_=S=f;for(var w=l,C=o;C<w;){var s=i[C];It(s,m,S,x,P)<It(s,v,b,g,_)?(w--,i[C]=i[w],i[w]=s):C++}if(w==r){for(var s=null,u=o;u<l;u++)s=Ct(s,i[u],t);return s}return NodeNew(t,Ot(t,i,o,w-o),Ot(t,i,w,l-w))};yt.prototype.optimize=function(){var t=new Array(this.count),e=0;for(var i in this.leaves)t[e++]=this.nodes[i];tree.subtreeRecycle(root),this.root=Ot(tree,t,t.length)};var Tt=function(t,e){!t.isLeaf&&e<=10&&(Tt(t.A,e+1),Tt(t.B,e+1));for(var i="",n=0;n<e;n++)i+=" ";console.log(i+t.bb_b+" "+t.bb_t)};yt.prototype.log=function(){this.root&&Tt(this.root,0)};var Lt=t.CollisionHandler=function(){this.a=this.b=0};Lt.prototype.begin=function(t,e){return!0},Lt.prototype.preSolve=function(t,e){return!0},Lt.prototype.postSolve=function(t,e){},Lt.prototype.separate=function(t,e){};var Et=function(t,e){this.e=0,this.u=0,this.surface_vr=x,this.a=t,this.body_a=t.body,this.b=e,this.body_b=e.body,this.thread_a_next=this.thread_a_prev=null,this.thread_b_next=this.thread_b_prev=null,this.contacts=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"};Et.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]},Et.prototype.totalImpulse=function(){for(var t=this.contacts,e=new S(0,0),i=0,n=t.length;i<n;i++){var o=t[i];e.add(G(o.n,o.jnAcc))}return this.swappedColl?e:e.neg()},Et.prototype.totalImpulseWithFriction=function(){for(var t=this.contacts,e=new S(0,0),i=0,n=t.length;i<n;i++){var o=t[i];e.add(new S(o.jnAcc,o.jtAcc).rotate(o.n))}return this.swappedColl?e:e.neg()},Et.prototype.totalKE=function(){for(var t=(1-this.e)/(1+this.e),e=0,i=this.contacts,n=0,o=i.length;n<o;n++){var r=i[n],s=r.jnAcc,a=r.jtAcc;e+=t*s*s/r.nMass+a*a/r.tMass}return e},Et.prototype.ignore=function(){this.state="ignore"},Et.prototype.getA=function(){return this.swappedColl?this.b:this.a},Et.prototype.getB=function(){return this.swappedColl?this.a:this.b},Et.prototype.isFirstContact=function(){return"first coll"===this.state};var Ft=function(t,e,i){this.point=t,this.normal=e,this.dist=i};Et.prototype.getContactPointSet=function(){var t,e=new Array(this.contacts.length);for(t=0;t<e.length;t++)e[t]=new Ft(this.contacts[t].p,this.contacts[t].n,this.contacts[t].dist);return e},Et.prototype.getNormal=function(t){var e=this.contacts[t].n;return this.swappedColl?k(e):e},Et.prototype.getPoint=function(t){return this.contacts[t].p},Et.prototype.getDepth=function(t){return this.contacts[t].dist};var Dt=function(t,e,i,n){i?i.body_a===e?i.thread_a_next=n:i.thread_b_next=n:e.arbiterList=n,n&&(n.body_a===e?n.thread_a_prev=i:n.thread_b_prev=i)};Et.prototype.unthread=function(){Dt(this,this.body_a,this.thread_a_prev,this.thread_a_next),Dt(this,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_a_prev=this.thread_a_next=null,this.thread_b_prev=this.thread_b_next=null},Et.prototype.update=function(t,e,i,n){if(this.contacts)for(var o=0;o<this.contacts.length;o++)for(var r=this.contacts[o],s=0;s<t.length;s++){var a=t[s];a.hash===r.hash&&(a.jnAcc=r.jnAcc,a.jtAcc=r.jtAcc)}this.contacts=t,this.handler=e,this.swappedColl=i.collision_type!==e.a,this.e=i.e*n.e,this.u=i.u*n.u,this.surface_vr=B(i.surface_v,n.surface_v),this.a=i,this.body_a=i.body,this.b=n,this.body_b=n.body,"cached"==this.state&&(this.state="first coll")},Et.prototype.preStep=function(t,i,n){for(var o=this.body_a,r=this.body_b,s=0;s<this.contacts.length;s++){var a=this.contacts[s];a.r1=B(a.p,o.p),a.r2=B(a.p,r.p),a.nMass=1/ge(o,r,a.r1,a.r2,a.n),a.tMass=1/ge(o,r,a.r1,a.r2,O(a.n)),a.bias=-n*e(0,a.dist+i)/t,a.jBias=0,a.bounce=de(o,r,a.r1,a.r2,a.n)*this.e}},Et.prototype.applyCachedImpulse=function(t){if(!this.isFirstContact())for(var e=this.body_a,i=this.body_b,n=0;n<this.contacts.length;n++){var o=this.contacts[n],r=o.n.x,s=o.n.y,a=r*o.jnAcc-s*o.jtAcc,h=r*o.jtAcc+s*o.jnAcc;
fe(e,i,o.r1,o.r2,a*t,h*t)}};var Nt=0,Rt=0;Et.prototype.applyImpulse=function(){Nt++;for(var t=this.body_a,e=this.body_b,i=this.surface_vr,o=this.u,r=0;r<this.contacts.length;r++){Rt++;var s=this.contacts[r],a=s.nMass,h=s.n,c=s.r1,p=s.r2,l=e.vx-p.y*e.w-(t.vx-c.y*t.w),u=e.vy+p.x*e.w-(t.vy+c.x*t.w),d=h.x*(e.v_biasx-p.y*e.w_bias-t.v_biasx+c.y*t.w_bias)+h.y*(p.x*e.w_bias+e.v_biasy-c.x*t.w_bias-t.v_biasy),y=w(l,u,h.x,h.y),f=w(l+i.x,u+i.y,-h.y,h.x),v=(s.bias-d)*a,b=s.jBias;s.jBias=n(b+v,0);var _=-(s.bounce+y)*a,m=s.jnAcc;s.jnAcc=n(m+_,0);var S=o*s.jnAcc,x=-f*s.tMass,P=s.jtAcc;s.jtAcc=g(P+x,-S,S);var C=h.x*(s.jBias-b),A=h.y*(s.jBias-b);ve(t,-C,-A,c),ve(e,C,A,p);var j=s.jnAcc-m,B=s.jtAcc-P;fe(t,e,c,p,h.x*j-h.y*B,h.x*B+h.y*j)}},Et.prototype.callSeparate=function(t){var e=t.lookupHandler(this.a.collision_type,this.b.collision_type);e.separate(this,t)},Et.prototype.next=function(t){return this.body_a==t?this.thread_a_next:this.thread_b_next};var Wt=0,Vt=function(t,e,i,n){this.p=t,this.n=e,this.dist=i,this.r1=this.r2=x,this.nMass=this.tMass=this.bounce=this.bias=0,this.jnAcc=this.jtAcc=this.jBias=0,this.hash=n,Wt++},Yt=[],qt=function(t,e,i,n){var o=i+n,r=B(e,t),s=F(r);if(!(s>=o*o)){var a=Math.sqrt(s);return new Vt(j(t,G(r,.5+(i-.5*o)/(a?a:1/0))),a?G(r,1/a):new S(1,0),a-o,0)}},Qt=function(t,e){var i=qt(t.tc,e.tc,t.r,e.r);return i?[i]:Yt},Ut=function(t,e){var i=e.ta,n=e.tb,o=t.tc,r=B(n,i),s=_(P(r,B(o,i))/F(r)),a=j(i,G(r,s)),h=qt(o,a,t.r,e.r);if(h){var c=h.n;return 0===s&&P(c,e.a_tangent)<0||1===s&&P(c,e.b_tangent)<0?Yt:[h]}return Yt},Ht=0,zt=function(t,e){var i=0,n=t.valueOnAxis(e[0].n,e[0].d);if(n>0)return-1;for(var o=1;o<e.length;o++){var r=t.valueOnAxis(e[o].n,e[o].d);if(r>0)return-1;r>n&&(n=r,i=o)}return Ht=n,i},Jt=function(t,e,i,n){for(var o=[],r=t.tVerts,s=0;s<r.length;s+=2){var a=r[s],c=r[s+1];e.containsVertPartial(a,c,k(i))&&o.push(new Vt(new S(a,c),i,n,h(t.hashid,s)))}for(var p=e.tVerts,s=0;s<p.length;s+=2){var a=p[s],c=p[s+1];t.containsVertPartial(a,c,i)&&o.push(new Vt(new S(a,c),i,n,h(e.hashid,s)))}return o},Kt=function(t,e,i,n){for(var o=[],r=t.tVerts,s=0;s<r.length;s+=2){var a=r[s],c=r[s+1];e.containsVert(a,c)&&o.push(new Vt(new S(a,c),i,n,h(t.hashid,s>>1)))}for(var p=e.tVerts,s=0;s<p.length;s+=2){var a=p[s],c=p[s+1];t.containsVert(a,c)&&o.push(new Vt(new S(a,c),i,n,h(e.hashid,s>>1)))}return o.length?o:Jt(t,e,i,n)},Xt=function(t,e){var i=zt(e,t.tPlanes);if(i==-1)return Yt;var n=Ht,o=zt(t,e.tPlanes);if(o==-1)return Yt;var r=Ht;return n>r?Kt(t,e,t.tPlanes[i].n,n):Kt(t,e,k(e.tPlanes[o].n),r)},Zt=function(t,i,n){var o=P(i,t.ta)-t.r,r=P(i,t.tb)-t.r;return e(o,r)-n},$t=function(t,e,i,n,o){for(var r=M(e.tn,e.ta),s=M(e.tn,e.tb),a=G(e.tn,o),c=i.tVerts,p=0;p<c.length;p+=2){var l=c[p],u=c[p+1];if(w(l,u,a.x,a.y)<P(e.tn,e.ta)*o+e.r){var d=I(e.tn.x,e.tn.y,l,u);r>=d&&d>=s&&t.push(new Vt(new S(l,u),a,n,h(i.hashid,p)))}}},te=function(t,e){var i=[],n=e.tPlanes,o=n.length,r=P(t.tn,t.ta),s=e.valueOnAxis(t.tn,r)-t.r,a=e.valueOnAxis(k(t.tn),-r)-t.r;if(a>0||s>0)return Yt;var c=0,p=Zt(t,n[0].n,n[0].d);if(p>0)return Yt;for(var l=0;l<o;l++){var u=Zt(t,n[l].n,n[l].d);if(u>0)return Yt;u>p&&(p=u,c=l)}var d=k(n[c].n),y=j(t.ta,G(d,t.r)),f=j(t.tb,G(d,t.r));if(e.containsVert(y.x,y.y)&&i.push(new Vt(y,d,p,h(t.hashid,0))),e.containsVert(f.x,f.y)&&i.push(new Vt(f,d,p,h(t.hashid,1))),(s>=p||a>=p)&&(s>a?$t(i,t,e,s,1):$t(i,t,e,a,-1)),0===i.length){var v,b=2*c,g=e.tVerts,_=new S(g[b],g[b+1]);if(v=qt(t.ta,_,t.r,0,i))return[v];if(v=qt(t.tb,_,t.r,0,i))return[v];var m=2*o,x=new S(g[(b+2)%m],g[(b+3)%m]);if(v=qt(t.ta,x,t.r,0,i))return[v];if(v=qt(t.tb,x,t.r,0,i))return[v]}return i},ee=function(t,e){for(var i=e.tPlanes,n=0,o=P(i[0].n,t.tc)-i[0].d-t.r,r=0;r<i.length;r++){var s=P(i[r].n,t.tc)-i[r].d-t.r;if(s>0)return Yt;s>o&&(o=s,n=r)}var a=i[n].n,h=e.tVerts,c=h.length,p=n<<1,l=h[p],u=h[p+1],d=h[(p+2)%c],y=h[(p+3)%c],f=I(a.x,a.y,l,u),v=I(a.x,a.y,d,y),b=M(a,t.tc);if(b<v){var g=qt(t.tc,new S(d,y),t.r,0,g);return g?[g]:Yt}if(b<f)return[new Vt(B(t.tc,G(a,t.r+o/2)),k(a),o,0)];var g=qt(t.tc,new S(l,u),t.r,0,g);return g?[g]:Yt};et.prototype.collisionCode=0,nt.prototype.collisionCode=1,rt.prototype.collisionCode=2,et.prototype.collisionTable=[Qt,Ut,ee],nt.prototype.collisionTable=[null,function(t,e){return Yt},te],rt.prototype.collisionTable=[null,null,Xt];var ie=t.collideShapes=function(t,e){return o(t.collisionCode<=e.collisionCode,"Collided shapes must be sorted by type"),t.collisionTable[e.collisionCode](t,e)},ne=new Lt,oe=t.Space=function(){this.stamp=0,this.curr_dt=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new yt(null),this.activeShapes=new yt(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=ne,this.postStepCallbacks=[],this.iterations=10,this.gravity=x,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=1/0,this.collisionSlop=.1,this.collisionBias=Math.pow(.9,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new ht(1/0,1/0),this.staticBody.nodeIdleTime=1/0,this.collideShapes=this.makeCollideShapes()};oe.prototype.getCurrentTimeStep=function(){return this.curr_dt},oe.prototype.setIterations=function(t){this.iterations=t},oe.prototype.isLocked=function(){return this.locked};var re=function(t){o(!t.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};oe.prototype.addCollisionHandler=function(t,e,i,n,o,r){re(this),this.removeCollisionHandler(t,e);var s=new Lt;s.a=t,s.b=e,i&&(s.begin=i),n&&(s.preSolve=n),o&&(s.postSolve=o),r&&(s.separate=r),this.collisionHandlers[h(t,e)]=s},oe.prototype.removeCollisionHandler=function(t,e){re(this),delete this.collisionHandlers[h(t,e)]},oe.prototype.setDefaultCollisionHandler=function(t,e,i,n){re(this);var o=new Lt;t&&(o.begin=t),e&&(o.preSolve=e),i&&(o.postSolve=i),n&&(o.separate=n),this.defaultHandler=o},oe.prototype.lookupHandler=function(t,e){return this.collisionHandlers[h(t,e)]||this.defaultHandler},oe.prototype.addShape=function(t){var e=t.body;return e.isStatic()?this.addStaticShape(t):(o(!t.space,"This shape is already added to a space and cannot be added to another."),re(this),e.activate(),e.addShape(t),t.update(e.p,e.rot),this.activeShapes.insert(t,t.hashid),t.space=this,t)},oe.prototype.addStaticShape=function(t){o(!t.space,"This shape is already added to a space and cannot be added to another."),re(this);var e=t.body;return e.addShape(t),t.update(e.p,e.rot),this.staticShapes.insert(t,t.hashid),t.space=this,t},oe.prototype.addBody=function(t){return o(!t.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated."),o(!t.space,"This body is already added to a space and cannot be added to another."),re(this),this.bodies.push(t),t.space=this,t},oe.prototype.addConstraint=function(t){o(!t.space,"This shape is already added to a space and cannot be added to another."),re(this);var e=t.a,i=t.b;return e.activate(),i.activate(),this.constraints.push(t),t.next_a=e.constraintList,e.constraintList=t,t.next_b=i.constraintList,i.constraintList=t,t.space=this,t},oe.prototype.filterArbiters=function(t,e){for(var i in this.cachedArbiters){var n=this.cachedArbiters[i];(t!==n.body_a||e!==n.a&&null!==e)&&(t!==n.body_b||e!==n.b&&null!==e)||(e&&"cached"!==n.state&&n.callSeparate(this),n.unthread(),c(this.arbiters,n),delete this.cachedArbiters[i])}},oe.prototype.removeShape=function(t){var e=t.body;e.isStatic()?this.removeStaticShape(t):(o(this.containsShape(t),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),re(this),e.activate(),e.removeShape(t),this.filterArbiters(e,t),this.activeShapes.remove(t,t.hashid),t.space=null)},oe.prototype.removeStaticShape=function(t){o(this.containsShape(t),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)"),re(this);var e=t.body;e.isStatic()&&e.activateStatic(t),e.removeShape(t),this.filterArbiters(e,t),this.staticShapes.remove(t,t.hashid),t.space=null},oe.prototype.removeBody=function(t){o(this.containsBody(t),"Cannot remove a body that was not added to the space. (Removed twice maybe?)"),re(this),t.activate(),c(this.bodies,t),t.space=null},oe.prototype.removeConstraint=function(t){o(this.containsConstraint(t),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)"),re(this),t.a.activate(),t.b.activate(),c(this.constraints,t),t.a.removeConstraint(t),t.b.removeConstraint(t),t.space=null},oe.prototype.containsShape=function(t){return t.space===this},oe.prototype.containsBody=function(t){return t.space==this},oe.prototype.containsConstraint=function(t){return t.space==this},oe.prototype.uncacheArbiter=function(t){delete this.cachedArbiters[h(t.a.hashid,t.b.hashid)],c(this.arbiters,t)},oe.prototype.eachBody=function(t){this.lock();for(var e=this.bodies,i=0;i<e.length;i++)t(e[i]);for(var n=this.sleepingComponents,i=0;i<n.length;i++)for(var o=n[i],r=o;r;){var s=r.nodeNext;t(r),r=s}this.unlock(!0)},oe.prototype.eachShape=function(t){this.lock(),this.activeShapes.each(t),this.staticShapes.each(t),this.unlock(!0)},oe.prototype.eachConstraint=function(t){this.lock();for(var e=this.constraints,i=0;i<e.length;i++)t(e[i]);this.unlock(!0)},oe.prototype.reindexStatic=function(){o(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete."),this.staticShapes.each(function(t){var e=t.body;t.update(e.p,e.rot)}),this.staticShapes.reindex()},oe.prototype.reindexShape=function(t){o(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var e=t.body;t.update(e.p,e.rot),this.activeShapes.reindexObject(t,t.hashid),this.staticShapes.reindexObject(t,t.hashid)},oe.prototype.reindexShapesForBody=function(t){for(var e=t.shapeList;e;e=e.next)this.reindexShape(e)},oe.prototype.useSpatialHash=function(t,e){throw new Error("Spatial Hash not yet implemented!")},oe.prototype.activateBody=function(t){if(o(!t.isRogue(),"Internal error: Attempting to activate a rogue body."),this.locked)this.rousedBodies.indexOf(t)===-1&&this.rousedBodies.push(t);else{this.bodies.push(t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.staticShapes.remove(i,i.hashid),this.activeShapes.insert(i,i.hashid)}for(var n=t.arbiterList;n;n=n.next(t)){var r=n.body_a;if(t===r||r.isStatic()){var s=n.a,a=n.b;this.cachedArbiters[h(s.hashid,a.hashid)]=n,n.stamp=this.stamp,n.handler=this.lookupHandler(s.collision_type,a.collision_type),this.arbiters.push(n)}}for(var c=t.constraintList;c;c=c.nodeNext){var r=c.a;(t===r||r.isStatic())&&this.constraints.push(c)}}},oe.prototype.deactivateBody=function(t){o(!t.isRogue(),"Internal error: Attempting to deactivate a rogue body."),c(this.bodies,t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.activeShapes.remove(i,i.hashid),this.staticShapes.insert(i,i.hashid)}for(var n=t.arbiterList;n;n=n.next(t)){var r=n.body_a;(t===r||r.isStatic())&&this.uncacheArbiter(n)}for(var s=t.constraintList;s;s=s.nodeNext){var r=s.a;(t===r||r.isStatic())&&c(this.constraints,s)}};var se=function(t){return t?t.nodeRoot:null},ae=function(t){if(t&&t.isSleeping(t)){o(!t.isRogue(),"Internal Error: componentActivate() called on a rogue body.");for(var e=t.space,i=t;i;){var n=i.nodeNext;i.nodeIdleTime=0,i.nodeRoot=null,i.nodeNext=null,e.activateBody(i),i=n}c(e.sleepingComponents,t)}};ht.prototype.activate=function(){this.isRogue()||(this.nodeIdleTime=0,ae(se(this)))},ht.prototype.activateStatic=function(t){o(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var e=this.arbiterList;e;e=e.next(this))t&&t!=e.a&&t!=e.b||(e.body_a==this?e.body_b:e.body_a).activate()},ht.prototype.pushArbiter=function(t){r(null===(t.body_a===this?t.thread_a_next:t.thread_b_next),"Internal Error: Dangling contact graph pointers detected. (A)"),r(null===(t.body_a===this?t.thread_a_prev:t.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (B)");var e=this.arbiterList;r(null===e||null===(e.body_a===this?e.thread_a_prev:e.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (C)"),t.body_a===this?t.thread_a_next=e:t.thread_b_next=e,e&&(e.body_a===this?e.thread_a_prev=t:e.thread_b_prev=t),this.arbiterList=t};var he=function(t,e){e.nodeRoot=t,e!==t&&(e.nodeNext=t.nodeNext,t.nodeNext=e)},ce=function(t,e){if(!e.isRogue()){var i=se(e);if(null==i){he(t,e);for(var n=e.arbiterList;n;n=n.next(e))ce(t,e==n.body_a?n.body_b:n.body_a);for(var o=e.constraintList;o;o=o.next(e))ce(t,e==o.a?o.b:o.a)}else r(i===t,"Internal Error: Inconsistency detected in the contact graph.")}},pe=function(t,e){for(var i=t;i;i=i.nodeNext)if(i.nodeIdleTime<e)return!0;return!1};oe.prototype.processComponents=function(t){for(var e=this.sleepTimeThreshold!==1/0,i=this.bodies,n=0;n<i.length;n++){var o=i[n];r(null===o.nodeNext,"Internal Error: Dangling next pointer detected in contact graph."),r(null===o.nodeRoot,"Internal Error: Dangling root pointer detected in contact graph.")}if(e)for(var s=this.idleSpeedThreshold,a=s?s*s:F(this.gravity)*t*t,n=0;n<i.length;n++){var o=i[n],h=a?o.m*a:0;o.nodeIdleTime=o.kineticEnergy()>h?0:o.nodeIdleTime+t}for(var c=this.arbiters,n=0,p=c.length;n<p;n++){var l=c[n],u=l.body_a,d=l.body_b;e&&((d.isRogue()&&!d.isStatic()||u.isSleeping())&&u.activate(),(u.isRogue()&&!u.isStatic()||d.isSleeping())&&d.activate()),u.pushArbiter(l),d.pushArbiter(l)}if(e){for(var y=this.constraints,n=0;n<y.length;n++){var f=y[n],u=f.a,d=f.b;d.isRogue()&&!d.isStatic()&&u.activate(),u.isRogue()&&!u.isStatic()&&d.activate()}for(var n=0;n<i.length;){var o=i[n];if(null!==se(o)||(ce(o,o),pe(o,this.sleepTimeThreshold)))n++,o.nodeRoot=null,o.nodeNext=null;else{this.sleepingComponents.push(o);for(var v=o;v;v=v.nodeNext)this.deactivateBody(v)}}}},ht.prototype.sleep=function(){this.sleepWithGroup(null)},ht.prototype.sleepWithGroup=function(t){o(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var e=this.space;if(o(e,"Cannot put a rogue body to sleep."),o(!e.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback."),o(null===t||t.isSleeping(),"Cannot use a non-sleeping body as a group identifier."),this.isSleeping())return void o(se(this)===se(t),"The body is already sleeping and it's group cannot be reassigned.");for(var i=0;i<this.shapeList.length;i++)this.shapeList[i].update(this.p,this.rot);if(e.deactivateBody(this),t){var n=se(t);this.nodeRoot=n,this.nodeNext=n.nodeNext,this.nodeIdleTime=0,n.nodeNext=this}else this.nodeRoot=this,this.nodeNext=null,this.nodeIdleTime=0,e.sleepingComponents.push(this);c(e.bodies,this)},oe.prototype.activateShapesTouchingShape=function(t){this.sleepTimeThreshold!==1/0&&this.shapeQuery(t,function(t,e){t.body.activate()})},oe.prototype.pointQuery=function(t,e,i,n){var o=function(o){(!o.group||i!==o.group)&&e&o.layers&&o.pointQuery(t)&&n(o)},r=new H(t.x,t.y,t.x,t.y);this.lock(),this.activeShapes.query(r,o),this.staticShapes.query(r,o),this.unlock(!0)},oe.prototype.pointQueryFirst=function(t,e,i){var n=null;return this.pointQuery(t,e,i,function(t){t.sensor||(n=t)}),n},oe.prototype.nearestPointQuery=function(t,e,i,n,o){var r=function(r){if((!r.group||n!==r.group)&&i&r.layers){var s=r.nearestPointQuery(t);s.d<e&&o(r,s.d,s.p)}},s=z(t,e);this.lock(),this.activeShapes.query(s,r),this.staticShapes.query(s,r),this.unlock(!0)},oe.prototype.nearestPointQueryNearest=function(t,e,i,n){var o,r=function(r){if((!r.group||n!==r.group)&&i&r.layers&&!r.sensor){var s=r.nearestPointQuery(t);s.d<e&&(!o||s.d<o.d)&&(o=s)}},s=z(t,e);return this.activeShapes.query(s,r),this.staticShapes.query(s,r),o},oe.prototype.segmentQuery=function(t,e,i,n,o){var r=function(r){var s;return(!r.group||n!==r.group)&&i&r.layers&&(s=r.segmentQuery(t,e))&&o(r,s.t,s.n),1};this.lock(),this.staticShapes.segmentQuery(t,e,1,r),this.activeShapes.segmentQuery(t,e,1,r),this.unlock(!0)},oe.prototype.segmentQueryFirst=function(t,e,i,n){var o=null,r=function(r){var s;return(!r.group||n!==r.group)&&i&r.layers&&!r.sensor&&(s=r.segmentQuery(t,e))&&(null===o||s.t<o.t)&&(o=s),o?o.t:1};return this.staticShapes.segmentQuery(t,e,1,r),this.activeShapes.segmentQuery(t,e,o?o.t:1,r),o},oe.prototype.bbQuery=function(t,e,i,n){var o=function(o){(!o.group||i!==o.group)&&e&o.layers&&J(t,o.bb_l,o.bb_b,o.bb_r,o.bb_t)&&n(o)};this.lock(),this.activeShapes.query(t,o),this.staticShapes.query(t,o),this.unlock(!0)},oe.prototype.shapeQuery=function(t,e){var i=t.body;i&&t.update(i.p,i.rot);var n=new H(t.bb_l,t.bb_b,t.bb_r,t.bb_t),o=!1,r=function(i){var n=t;if((!n.group||n.group!==i.group)&&n.layers&i.layers&&n!==i){var r;if(n.collisionCode<=i.collisionCode)r=ie(n,i);else{r=ie(i,n);for(var s=0;s<r.length;s++)r[s].n=k(r[s].n)}if(r.length&&(o=!(n.sensor||i.sensor),e)){for(var a=new Array(r.length),s=0;s<r.length;s++)a[s]=new Ft(r[s].p,r[s].n,r[s].dist);e(i,a)}}};return this.lock(),this.activeShapes.query(n,r),this.staticShapes.query(n,r),this.unlock(!0),o},oe.prototype.addPostStepCallback=function(t){r(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(t)},oe.prototype.runPostStepCallbacks=function(){for(var t=0;t<this.postStepCallbacks.length;t++)this.postStepCallbacks[t]();this.postStepCallbacks=[]},oe.prototype.lock=function(){this.locked++},oe.prototype.unlock=function(t){if(this.locked--,o(this.locked>=0,"Internal Error: Space lock underflow."),0===this.locked&&t){for(var e=this.rousedBodies,i=0;i<e.length;i++)this.activateBody(e[i]);e.length=0,this.runPostStepCallbacks()}},oe.prototype.makeCollideShapes=function(){var t=this;return function(e,i){var n=t;if(e.bb_l<=i.bb_r&&i.bb_l<=e.bb_r&&e.bb_b<=i.bb_t&&i.bb_b<=e.bb_t&&e.body!==i.body&&(!e.group||e.group!==i.group)&&e.layers&i.layers){var o=n.lookupHandler(e.collision_type,i.collision_type),r=e.sensor||i.sensor;if(!r||o!==ne){if(e.collisionCode>i.collisionCode){var s=e;e=i,i=s}var a=ie(e,i);if(0!==a.length){var c=h(e.hashid,i.hashid),p=n.cachedArbiters[c];p||(p=n.cachedArbiters[c]=new Et(e,i)),p.update(a,o,e,i),"first coll"!=p.state||o.begin(p,n)||p.ignore(),"ignore"!==p.state&&o.preSolve(p,n)&&!r?n.arbiters.push(p):(p.contacts=null,"ignore"!==p.state&&(p.state="normal")),p.stamp=n.stamp}}}}},oe.prototype.arbiterSetFilter=function(t){var e=this.stamp-t.stamp,i=t.body_a,n=t.body_b;return!(!i.isStatic()&&!i.isSleeping()||!n.isStatic()&&!n.isSleeping())||(e>=1&&"cached"!=t.state&&(t.callSeparate(this),t.state="cached"),!(e>=this.collisionPersistence)||(t.contacts=null,!1))};var le=function(t){var e=t.body;t.update(e.p,e.rot)};oe.prototype.step=function(t){if(0!==t){o(0===x.x&&0===x.y,"vzero is invalid"),this.stamp++;var e=this.curr_dt;this.curr_dt=t;var i,n,r,s=this.bodies,a=this.constraints,h=this.arbiters;for(i=0;i<h.length;i++){var c=h[i];c.state="normal",c.body_a.isSleeping()||c.body_b.isSleeping()||c.unthread()}for(h.length=0,this.lock(),i=0;i<s.length;i++)s[i].position_func(t);this.activeShapes.each(le),this.activeShapes.reindexQuery(this.collideShapes),this.unlock(!1),this.processComponents(t),this.lock();for(r in this.cachedArbiters)this.arbiterSetFilter(this.cachedArbiters[r])||delete this.cachedArbiters[r];var p=this.collisionSlop,l=1-Math.pow(this.collisionBias,t);for(i=0;i<h.length;i++)h[i].preStep(t,p,l);for(i=0;i<a.length;i++){var u=a[i];u.preSolve(this),u.preStep(t)}var d=Math.pow(this.damping,t),y=this.gravity;for(i=0;i<s.length;i++)s[i].velocity_func(y,d,t);var f=0===e?0:t/e;for(i=0;i<h.length;i++)h[i].applyCachedImpulse(f);for(i=0;i<a.length;i++)a[i].applyCachedImpulse(f);for(i=0;i<this.iterations;i++){for(n=0;n<h.length;n++)h[n].applyImpulse();for(n=0;n<a.length;n++)a[n].applyImpulse()}for(i=0;i<a.length;i++)a[i].postSolve(this);for(i=0;i<h.length;i++)h[i].handler.postSolve(h[i],this);this.unlock(!0)}};var ue=function(t,e,i,n){var o=t.vx+-i.y*t.w,r=t.vy+i.x*t.w,s=e.vx+-n.y*e.w,a=e.vy+n.x*e.w;return new S(s-o,a-r)},de=function(t,e,i,n,o){var r=t.vx+-i.y*t.w,s=t.vy+i.x*t.w,a=e.vx+-n.y*e.w,h=e.vy+n.x*e.w;return w(a-r,h-s,o.x,o.y)},ye=function(t,e,i,n){t.vx+=e*t.m_inv,t.vy+=i*t.m_inv,t.w+=t.i_inv*(n.x*i-n.y*e)},fe=function(t,e,i,n,o,r){ye(t,-o,-r,i),ye(e,o,r,n)},ve=function(t,e,i,n){t.v_biasx+=e*t.m_inv,t.v_biasy+=i*t.m_inv,t.w_bias+=t.i_inv*I(n.x,n.y,e,i)},be=function(t,e,i){var n=M(e,i);return t.m_inv+t.i_inv*n*n},ge=function(t,e,i,n,o){var s=be(t,i,o)+be(e,n,o);return r(0!==s,"Unsolvable collision or constraint."),s},_e=function(t,e,i,n,o,s){var a,h,c,p,l=t.m_inv+e.m_inv;a=l,h=0,c=0,p=l;var u=t.i_inv,d=i.x*i.x*u,y=i.y*i.y*u,f=-i.x*i.y*u;a+=y,h+=f,c+=f,p+=d;var v=e.i_inv,b=n.x*n.x*v,g=n.y*n.y*v,_=-n.x*n.y*v;a+=g,h+=_,c+=_,p+=b;var m=a*p-h*c;r(0!==m,"Unsolvable constraint.");var S=1/m;o.x=p*S,o.y=-h*S,s.x=-c*S,s.y=a*S},me=function(t,e,i){return new S(P(t,e),P(t,i))},Se=function(t,e){return 1-Math.pow(t,e)},xe=t.Constraint=function(t,e){this.a=t,this.b=e,this.space=null,this.next_a=null,this.next_b=null,this.maxForce=1/0,this.errorBias=Math.pow(.9,60),this.maxBias=1/0};xe.prototype.activateBodies=function(){this.a&&this.a.activate(),this.b&&this.b.activate()},xe.prototype.preStep=function(t){},xe.prototype.applyCachedImpulse=function(t){},xe.prototype.applyImpulse=function(){},xe.prototype.getImpulse=function(){return 0},xe.prototype.preSolve=function(t){},xe.prototype.postSolve=function(t){},xe.prototype.next=function(t){return this.a===t?this.next_a:this.next_b};var Pe=t.PinJoint=function(t,e,i,n){xe.call(this,t,e),this.anchr1=i,this.anchr2=n;var o=t?j(t.p,L(i,t.rot)):i,s=e?j(e.p,L(n,e.rot)):n;this.dist=C(B(s,o)),r(this.dist>0,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.r1=this.r2=null,this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};Pe.prototype=Object.create(xe.prototype),Pe.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=L(this.anchr1,e.rot),this.r2=L(this.anchr2,i.rot);var n=B(j(i.p,this.r2),j(e.p,this.r1)),o=C(n);this.n=G(n,1/(o?o:1/0)),this.nMass=1/ge(e,i,this.r1,this.r2,this.n);var r=this.maxBias;this.bias=g(-Se(this.errorBias,t)*(o-this.dist)/t,-r,r),this.jnMax=this.maxForce*t},Pe.prototype.applyCachedImpulse=function(t){var e=G(this.n,this.jnAcc*t);fe(this.a,this.b,this.r1,this.r2,e.x,e.y)},Pe.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=de(t,e,this.r1,this.r2,i),o=(this.bias-n)*this.nMass,r=this.jnAcc;this.jnAcc=g(r+o,-this.jnMax,this.jnMax),o=this.jnAcc-r,fe(t,e,this.r1,this.r2,i.x*o,i.y*o)},Pe.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var we=t.SlideJoint=function(t,e,i,n,o,r){xe.call(this,t,e),this.anchr1=i,this.anchr2=n,this.min=o,this.max=r,this.r1=this.r2=this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};we.prototype=Object.create(xe.prototype),we.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=L(this.anchr1,e.rot),this.r2=L(this.anchr2,i.rot);var n=B(j(i.p,this.r2),j(e.p,this.r1)),o=C(n),r=0;o>this.max?(r=o-this.max,this.n=W(n)):o<this.min?(r=this.min-o,this.n=k(W(n))):(this.n=x,this.jnAcc=0),this.nMass=1/ge(e,i,this.r1,this.r2,this.n);var s=this.maxBias;this.bias=g(-Se(this.errorBias,t)*r/t,-s,s),this.jnMax=this.maxForce*t},we.prototype.applyCachedImpulse=function(t){var e=this.jnAcc*t;fe(this.a,this.b,this.r1,this.r2,this.n.x*e,this.n.y*e)},we.prototype.applyImpulse=function(){if(0!==this.n.x||0!==this.n.y){var t=this.a,e=this.b,i=this.n,n=this.r1,o=this.r2,r=ue(t,e,n,o),s=P(r,i),a=(this.bias-s)*this.nMass,h=this.jnAcc;this.jnAcc=g(h+a,-this.jnMax,0),a=this.jnAcc-h,fe(t,e,this.r1,this.r2,i.x*a,i.y*a)}},we.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Ce=t.PivotJoint=function(t,e,i,n){if(xe.call(this,t,e),"undefined"==typeof n){var o=i;i=t?t.world2Local(o):o,n=e?e.world2Local(o):o}this.anchr1=i,this.anchr2=n,this.r1=this.r2=x,this.k1=new S(0,0),this.k2=new S(0,0),this.jAcc=x,this.jMaxLen=0,this.bias=x};Ce.prototype=Object.create(xe.prototype),Ce.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=L(this.anchr1,e.rot),this.r2=L(this.anchr2,i.rot),_e(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var n=B(j(i.p,this.r2),j(e.p,this.r1));this.bias=V(G(n,-Se(this.errorBias,t)/t),this.maxBias)},Ce.prototype.applyCachedImpulse=function(t){fe(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},Ce.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,n=this.r2,o=ue(t,e,i,n),r=me(B(this.bias,o),this.k1,this.k2),s=this.jAcc;this.jAcc=V(j(this.jAcc,r),this.jMaxLen),fe(t,e,this.r1,this.r2,this.jAcc.x-s.x,this.jAcc.y-s.y)},Ce.prototype.getImpulse=function(){return C(this.jAcc)};var Ae=t.GrooveJoint=function(t,e,i,n,o){xe.call(this,t,e),this.grv_a=i,this.grv_b=n,this.grv_n=O(R(B(n,i))),this.anchr2=o,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new S(0,0),this.k2=new S(0,0),this.jAcc=x,this.jMaxLen=0,this.bias=null};Ae.prototype=Object.create(xe.prototype),Ae.prototype.preStep=function(t){var e=this.a,i=this.b,n=e.local2World(this.grv_a),o=e.local2World(this.grv_b),r=L(this.grv_n,e.rot),s=P(n,r);this.grv_tn=r,this.r2=L(this.anchr2,i.rot);var a=M(j(i.p,this.r2),r);a<=M(n,r)?(this.clamp=1,this.r1=B(n,e.p)):a>=M(o,r)?(this.clamp=-1,this.r1=B(o,e.p)):(this.clamp=0,this.r1=B(j(G(O(r),-a),G(r,s)),e.p)),_e(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var h=B(j(i.p,this.r2),j(e.p,this.r1));this.bias=V(G(h,-Se(this.errorBias,t)/t),this.maxBias)},Ae.prototype.applyCachedImpulse=function(t){fe(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},Ae.prototype.grooveConstrain=function(t){var e=this.grv_tn,i=this.clamp*M(t,e)>0?t:T(t,e);return V(i,this.jMaxLen)},Ae.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,n=this.r2,o=ue(t,e,i,n),r=me(B(this.bias,o),this.k1,this.k2),s=this.jAcc;this.jAcc=this.grooveConstrain(j(s,r)),fe(t,e,this.r1,this.r2,this.jAcc.x-s.x,this.jAcc.y-s.y)},Ae.prototype.getImpulse=function(){return C(this.jAcc)},Ae.prototype.setGrooveA=function(t){this.grv_a=t,this.grv_n=O(R(B(this.grv_b,t))),this.activateBodies()},Ae.prototype.setGrooveB=function(t){this.grv_b=t,this.grv_n=O(R(B(t,this.grv_a))),this.activateBodies()};var je=function(t,e){return(t.restLength-e)*t.stiffness},Be=t.DampedSpring=function(t,e,i,n,o,r,s){xe.call(this,t,e),this.anchr1=i,this.anchr2=n,this.restLength=o,this.stiffness=r,this.damping=s,this.springForceFunc=je,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null};Be.prototype=Object.create(xe.prototype),Be.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=L(this.anchr1,e.rot),this.r2=L(this.anchr2,i.rot);var n=B(j(i.p,this.r2),j(e.p,this.r1)),o=C(n);this.n=G(n,1/(o?o:1/0));var s=ge(e,i,this.r1,this.r2,this.n);r(0!==s,"Unsolvable this."),this.nMass=1/s,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*t*s);var a=this.springForceFunc(this,o);fe(e,i,this.r1,this.r2,this.n.x*a*t,this.n.y*a*t)},Be.prototype.applyCachedImpulse=function(t){},Be.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=this.r1,o=this.r2,r=de(t,e,n,o,i),s=(this.target_vrn-r)*this.v_coef;this.target_vrn=r+s,s*=this.nMass,fe(t,e,this.r1,this.r2,this.n.x*s,this.n.y*s)},Be.prototype.getImpulse=function(){return 0};var ke=function(t,e){return(e-t.restAngle)*t.stiffness},Ge=t.DampedRotarySpring=function(t,e,i,n,o){xe.call(this,t,e),this.restAngle=i,this.stiffness=n,this.damping=o,this.springTorqueFunc=ke,this.target_wrn=0,this.w_coef=0,this.iSum=0};Ge.prototype=Object.create(xe.prototype),Ge.prototype.preStep=function(t){var e=this.a,i=this.b,n=e.i_inv+i.i_inv;r(0!==n,"Unsolvable spring."),this.iSum=1/n,this.w_coef=1-Math.exp(-this.damping*t*n),this.target_wrn=0;var o=this.springTorqueFunc(this,e.a-i.a)*t;e.w-=o*e.i_inv,i.w+=o*i.i_inv},Ge.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=t.w-e.w,n=(this.target_wrn-i)*this.w_coef;this.target_wrn=i+n;var o=n*this.iSum;t.w+=o*t.i_inv,e.w-=o*e.i_inv};var Me=t.RotaryLimitJoint=function(t,e,i,n){xe.call(this,t,e),this.min=i,this.max=n,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Me.prototype=Object.create(xe.prototype),Me.prototype.preStep=function(t){var e=this.a,i=this.b,n=i.a-e.a,o=0;n>this.max?o=this.max-n:n<this.min&&(o=this.min-n),this.iSum=1/(1/e.i+1/i.i);var r=this.maxBias;this.bias=g(-Se(this.errorBias,t)*o/t,-r,r),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},Me.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Me.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,n=-(this.bias+i)*this.iSum,o=this.jAcc;this.bias<0?this.jAcc=g(o+n,0,this.jMax):this.jAcc=g(o+n,-this.jMax,0),n=this.jAcc-o,t.w-=n*t.i_inv,e.w+=n*e.i_inv}},Me.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var Ie=t.RatchetJoint=function(t,e,i,n){xe.call(this,t,e),this.angle=0,this.phase=i,this.ratchet=n,this.angle=(e?e.a:0)-(t?t.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0};Ie.prototype=Object.create(xe.prototype),Ie.prototype.preStep=function(t){var e=this.a,i=this.b,n=this.angle,o=this.phase,r=this.ratchet,s=i.a-e.a,a=n-s,h=0;a*r>0?h=a:this.angle=Math.floor((s-o)/r)*r+o,this.iSum=1/(e.i_inv+i.i_inv);var c=this.maxBias;this.bias=g(-Se(this.errorBias,t)*h/t,-c,c),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},Ie.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Ie.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,n=this.ratchet,o=-(this.bias+i)*this.iSum,r=this.jAcc;this.jAcc=g((r+o)*n,0,this.jMax*Math.abs(n))/n,o=this.jAcc-r,t.w-=o*t.i_inv,e.w+=o*e.i_inv}},Ie.prototype.getImpulse=function(t){return Math.abs(t.jAcc)};var Oe=t.GearJoint=function(t,e,i,n){xe.call(this,t,e),this.phase=i,this.ratio=n,this.ratio_inv=1/n,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Oe.prototype=Object.create(xe.prototype),Oe.prototype.preStep=function(t){var e=this.a,i=this.b;this.iSum=1/(e.i_inv*this.ratio_inv+this.ratio*i.i_inv);var n=this.maxBias;this.bias=g(-Se(this.errorBias,t)*(i.a*this.ratio-e.a-this.phase)/t,-n,n),this.jMax=this.maxForce*t},Oe.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv*this.ratio_inv,i.w+=n*i.i_inv},Oe.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w*this.ratio-t.w,n=(this.bias-i)*this.iSum,o=this.jAcc;this.jAcc=g(o+n,-this.jMax,this.jMax),n=this.jAcc-o,t.w-=n*t.i_inv*this.ratio_inv,e.w+=n*e.i_inv},Oe.prototype.getImpulse=function(){return Math.abs(this.jAcc)},Oe.prototype.setRatio=function(t){this.ratio=t,this.ratio_inv=1/t,this.activateBodies()};var Te=t.SimpleMotor=function(t,e,i){xe.call(this,t,e),this.rate=i,this.jAcc=0,this.iSum=this.jMax=0};Te.prototype=Object.create(xe.prototype),Te.prototype.preStep=function(t){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*t},Te.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Te.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w-t.w+this.rate,n=-i*this.iSum,o=this.jAcc;this.jAcc=g(o+n,-this.jMax,this.jMax),n=this.jAcc-o,t.w-=n*t.i_inv,e.w+=n*e.i_inv},Te.prototype.getImpulse=function(){return Math.abs(this.jAcc)}}()},{}],3:[function(t,e,i){function n(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}var o=t("color-name"),r={};for(var s in o)o.hasOwnProperty(s)&&(r[o[s]]=s);var a=e.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]
},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var h in a)if(a.hasOwnProperty(h)){if(!("channels"in a[h]))throw new Error("missing channels property: "+h);if(!("labels"in a[h]))throw new Error("missing channel labels property: "+h);if(a[h].labels.length!==a[h].channels)throw new Error("channel and label counts mismatch: "+h);var c=a[h].channels,p=a[h].labels;delete a[h].channels,delete a[h].labels,Object.defineProperty(a[h],"channels",{value:c}),Object.defineProperty(a[h],"labels",{value:p})}a.rgb.hsl=function(t){var e,i,n,o=t[0]/255,r=t[1]/255,s=t[2]/255,a=Math.min(o,r,s),h=Math.max(o,r,s),c=h-a;return h===a?e=0:o===h?e=(r-s)/c:r===h?e=2+(s-o)/c:s===h&&(e=4+(o-r)/c),e=Math.min(60*e,360),e<0&&(e+=360),n=(a+h)/2,i=h===a?0:n<=.5?c/(h+a):c/(2-h-a),[e,100*i,100*n]},a.rgb.hsv=function(t){var e,i,n,o,r,s=t[0]/255,a=t[1]/255,h=t[2]/255,c=Math.max(s,a,h),p=c-Math.min(s,a,h),l=function(t){return(c-t)/6/p+.5};return 0===p?o=r=0:(r=p/c,e=l(s),i=l(a),n=l(h),s===c?o=n-i:a===c?o=1/3+e-n:h===c&&(o=2/3+i-e),o<0?o+=1:o>1&&(o-=1)),[360*o,100*r,100*c]},a.rgb.hwb=function(t){var e=t[0],i=t[1],n=t[2],o=a.rgb.hsl(t)[0],r=1/255*Math.min(e,Math.min(i,n));return n=1-1/255*Math.max(e,Math.max(i,n)),[o,100*r,100*n]},a.rgb.cmyk=function(t){var e,i,n,o,r=t[0]/255,s=t[1]/255,a=t[2]/255;return o=Math.min(1-r,1-s,1-a),e=(1-r-o)/(1-o)||0,i=(1-s-o)/(1-o)||0,n=(1-a-o)/(1-o)||0,[100*e,100*i,100*n,100*o]},a.rgb.keyword=function(t){var e=r[t];if(e)return e;var i,s=1/0;for(var a in o)if(o.hasOwnProperty(a)){var h=o[a],c=n(t,h);c<s&&(s=c,i=a)}return i},a.keyword.rgb=function(t){return o[t]},a.rgb.xyz=function(t){var e=t[0]/255,i=t[1]/255,n=t[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;var o=.4124*e+.3576*i+.1805*n,r=.2126*e+.7152*i+.0722*n,s=.0193*e+.1192*i+.9505*n;return[100*o,100*r,100*s]},a.rgb.lab=function(t){var e,i,n,o=a.rgb.xyz(t),r=o[0],s=o[1],h=o[2];return r/=95.047,s/=100,h/=108.883,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,h=h>.008856?Math.pow(h,1/3):7.787*h+16/116,e=116*s-16,i=500*(r-s),n=200*(s-h),[e,i,n]},a.hsl.rgb=function(t){var e,i,n,o,r,s=t[0]/360,a=t[1]/100,h=t[2]/100;if(0===a)return r=255*h,[r,r,r];i=h<.5?h*(1+a):h+a-h*a,e=2*h-i,o=[0,0,0];for(var c=0;c<3;c++)n=s+1/3*-(c-1),n<0&&n++,n>1&&n--,r=6*n<1?e+6*(i-e)*n:2*n<1?i:3*n<2?e+(i-e)*(2/3-n)*6:e,o[c]=255*r;return o},a.hsl.hsv=function(t){var e,i,n=t[0],o=t[1]/100,r=t[2]/100,s=o,a=Math.max(r,.01);return r*=2,o*=r<=1?r:2-r,s*=a<=1?a:2-a,i=(r+o)/2,e=0===r?2*s/(a+s):2*o/(r+o),[n,100*e,100*i]},a.hsv.rgb=function(t){var e=t[0]/60,i=t[1]/100,n=t[2]/100,o=Math.floor(e)%6,r=e-Math.floor(e),s=255*n*(1-i),a=255*n*(1-i*r),h=255*n*(1-i*(1-r));switch(n*=255,o){case 0:return[n,h,s];case 1:return[a,n,s];case 2:return[s,n,h];case 3:return[s,a,n];case 4:return[h,s,n];case 5:return[n,s,a]}},a.hsv.hsl=function(t){var e,i,n,o=t[0],r=t[1]/100,s=t[2]/100,a=Math.max(s,.01);return n=(2-r)*s,e=(2-r)*a,i=r*a,i/=e<=1?e:2-e,i=i||0,n/=2,[o,100*i,100*n]},a.hwb.rgb=function(t){var e,i,n,o,r=t[0]/360,s=t[1]/100,a=t[2]/100,h=s+a;h>1&&(s/=h,a/=h),e=Math.floor(6*r),i=1-a,n=6*r-e,0!==(1&e)&&(n=1-n),o=s+n*(i-s);var c,p,l;switch(e){default:case 6:case 0:c=i,p=o,l=s;break;case 1:c=o,p=i,l=s;break;case 2:c=s,p=i,l=o;break;case 3:c=s,p=o,l=i;break;case 4:c=o,p=s,l=i;break;case 5:c=i,p=s,l=o}return[255*c,255*p,255*l]},a.cmyk.rgb=function(t){var e,i,n,o=t[0]/100,r=t[1]/100,s=t[2]/100,a=t[3]/100;return e=1-Math.min(1,o*(1-a)+a),i=1-Math.min(1,r*(1-a)+a),n=1-Math.min(1,s*(1-a)+a),[255*e,255*i,255*n]},a.xyz.rgb=function(t){var e,i,n,o=t[0]/100,r=t[1]/100,s=t[2]/100;return e=3.2406*o+r*-1.5372+s*-.4986,i=o*-.9689+1.8758*r+.0415*s,n=.0557*o+r*-.204+1.057*s,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,e=Math.min(Math.max(0,e),1),i=Math.min(Math.max(0,i),1),n=Math.min(Math.max(0,n),1),[255*e,255*i,255*n]},a.xyz.lab=function(t){var e,i,n,o=t[0],r=t[1],s=t[2];return o/=95.047,r/=100,s/=108.883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,e=116*r-16,i=500*(o-r),n=200*(r-s),[e,i,n]},a.lab.xyz=function(t){var e,i,n,o=t[0],r=t[1],s=t[2];i=(o+16)/116,e=r/500+i,n=i-s/200;var a=Math.pow(i,3),h=Math.pow(e,3),c=Math.pow(n,3);return i=a>.008856?a:(i-16/116)/7.787,e=h>.008856?h:(e-16/116)/7.787,n=c>.008856?c:(n-16/116)/7.787,e*=95.047,i*=100,n*=108.883,[e,i,n]},a.lab.lch=function(t){var e,i,n,o=t[0],r=t[1],s=t[2];return e=Math.atan2(s,r),i=360*e/2/Math.PI,i<0&&(i+=360),n=Math.sqrt(r*r+s*s),[o,n,i]},a.lch.lab=function(t){var e,i,n,o=t[0],r=t[1],s=t[2];return n=s/360*2*Math.PI,e=r*Math.cos(n),i=r*Math.sin(n),[o,e,i]},a.rgb.ansi16=function(t){var e=t[0],i=t[1],n=t[2],o=1 in arguments?arguments[1]:a.rgb.hsv(t)[2];if(o=Math.round(o/50),0===o)return 30;var r=30+(Math.round(n/255)<<2|Math.round(i/255)<<1|Math.round(e/255));return 2===o&&(r+=60),r},a.hsv.ansi16=function(t){return a.rgb.ansi16(a.hsv.rgb(t),t[2])},a.rgb.ansi256=function(t){var e=t[0],i=t[1],n=t[2];if(e===i&&i===n)return e<8?16:e>248?231:Math.round((e-8)/247*24)+232;var o=16+36*Math.round(e/255*5)+6*Math.round(i/255*5)+Math.round(n/255*5);return o},a.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];var i=.5*(~~(t>50)+1),n=(1&e)*i*255,o=(e>>1&1)*i*255,r=(e>>2&1)*i*255;return[n,o,r]},a.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}t-=16;var i,n=Math.floor(t/36)/5*255,o=Math.floor((i=t%36)/6)/5*255,r=i%6/5*255;return[n,o,r]},a.rgb.hex=function(t){var e=((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2])),i=e.toString(16).toUpperCase();return"000000".substring(i.length)+i},a.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var i=e[0];3===e[0].length&&(i=i.split("").map(function(t){return t+t}).join(""));var n=parseInt(i,16),o=n>>16&255,r=n>>8&255,s=255&n;return[o,r,s]},a.rgb.hcg=function(t){var e,i,n=t[0]/255,o=t[1]/255,r=t[2]/255,s=Math.max(Math.max(n,o),r),a=Math.min(Math.min(n,o),r),h=s-a;return e=h<1?a/(1-h):0,i=h<=0?0:s===n?(o-r)/h%6:s===o?2+(r-n)/h:4+(n-o)/h+4,i/=6,i%=1,[360*i,100*h,100*e]},a.hsl.hcg=function(t){var e=t[1]/100,i=t[2]/100,n=1,o=0;return n=i<.5?2*e*i:2*e*(1-i),n<1&&(o=(i-.5*n)/(1-n)),[t[0],100*n,100*o]},a.hsv.hcg=function(t){var e=t[1]/100,i=t[2]/100,n=e*i,o=0;return n<1&&(o=(i-n)/(1-n)),[t[0],100*n,100*o]},a.hcg.rgb=function(t){var e=t[0]/360,i=t[1]/100,n=t[2]/100;if(0===i)return[255*n,255*n,255*n];var o=[0,0,0],r=e%1*6,s=r%1,a=1-s,h=0;switch(Math.floor(r)){case 0:o[0]=1,o[1]=s,o[2]=0;break;case 1:o[0]=a,o[1]=1,o[2]=0;break;case 2:o[0]=0,o[1]=1,o[2]=s;break;case 3:o[0]=0,o[1]=a,o[2]=1;break;case 4:o[0]=s,o[1]=0,o[2]=1;break;default:o[0]=1,o[1]=0,o[2]=a}return h=(1-i)*n,[255*(i*o[0]+h),255*(i*o[1]+h),255*(i*o[2]+h)]},a.hcg.hsv=function(t){var e=t[1]/100,i=t[2]/100,n=e+i*(1-e),o=0;return n>0&&(o=e/n),[t[0],100*o,100*n]},a.hcg.hsl=function(t){var e=t[1]/100,i=t[2]/100,n=i*(1-e)+.5*e,o=0;return n>0&&n<.5?o=e/(2*n):n>=.5&&n<1&&(o=e/(2*(1-n))),[t[0],100*o,100*n]},a.hcg.hwb=function(t){var e=t[1]/100,i=t[2]/100,n=e+i*(1-e);return[t[0],100*(n-e),100*(1-n)]},a.hwb.hcg=function(t){var e=t[1]/100,i=t[2]/100,n=1-i,o=n-e,r=0;return o<1&&(r=(n-o)/(1-o)),[t[0],100*o,100*r]},a.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},a.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},a.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},a.gray.hsl=a.gray.hsv=function(t){return[0,0,t[0]]},a.gray.hwb=function(t){return[0,100,t[0]]},a.gray.cmyk=function(t){return[0,0,0,t[0]]},a.gray.lab=function(t){return[t[0],0,0]},a.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),i=(e<<16)+(e<<8)+e,n=i.toString(16).toUpperCase();return"000000".substring(n.length)+n},a.rgb.gray=function(t){var e=(t[0]+t[1]+t[2])/3;return[e/255*100]}},{"color-name":6}],4:[function(t,e,i){function n(t){var e=function(e){return void 0===e||null===e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}function o(t){var e=function(e){if(void 0===e||null===e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var i=t(e);if("object"==typeof i)for(var n=i.length,o=0;o<n;o++)i[o]=Math.round(i[o]);return i};return"conversion"in t&&(e.conversion=t.conversion),e}var r=t("./conversions"),s=t("./route"),a={},h=Object.keys(r);h.forEach(function(t){a[t]={},Object.defineProperty(a[t],"channels",{value:r[t].channels}),Object.defineProperty(a[t],"labels",{value:r[t].labels});var e=s(t),i=Object.keys(e);i.forEach(function(i){var r=e[i];a[t][i]=o(r),a[t][i].raw=n(r)})}),e.exports=a},{"./conversions":3,"./route":5}],5:[function(t,e,i){function n(){for(var t={},e=Object.keys(a),i=e.length,n=0;n<i;n++)t[e[n]]={distance:-1,parent:null};return t}function o(t){var e=n(),i=[t];for(e[t].distance=0;i.length;)for(var o=i.pop(),r=Object.keys(a[o]),s=r.length,h=0;h<s;h++){var c=r[h],p=e[c];p.distance===-1&&(p.distance=e[o].distance+1,p.parent=o,i.unshift(c))}return e}function r(t,e){return function(i){return e(t(i))}}function s(t,e){for(var i=[e[t].parent,t],n=a[e[t].parent][t],o=e[t].parent;e[o].parent;)i.unshift(e[o].parent),n=r(a[e[o].parent][o],n),o=e[o].parent;return n.conversion=i,n}var a=t("./conversions");e.exports=function(t){for(var e=o(t),i={},n=Object.keys(e),r=n.length,a=0;a<r;a++){var h=n[a],c=e[h];null!==c.parent&&(i[h]=s(h,e))}return i}},{"./conversions":3}],6:[function(t,e,i){e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},{}],7:[function(t,e,i){var n=t("PhysicsGaming");loadFromDict=n.loadFromDict},{PhysicsGaming:1}]},{},[7]);
